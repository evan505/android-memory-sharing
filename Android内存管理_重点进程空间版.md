# Androidå†…å­˜ç®¡ç†æ·±åº¦è§£æ
## å±‚å±‚æ”¾å¤§å¼æŠ€æœ¯æ¼”è®² - é‡ç‚¹è§£æè¿›ç¨‹å†…å­˜ç©ºé—´

---

## ğŸ” æ¼”è®²æ¦‚è§ˆï¼šèšç„¦è¿›ç¨‹ç©ºé—´çš„æ˜¾å¾®é•œä¹‹æ—…

**æ¼”è®²ä¸»é¢˜**: Androidå†…å­˜ç®¡ç† - è¿›ç¨‹ç©ºé—´æ·±åº¦è§£æ  
**ç›®æ ‡å—ä¼—**: Java/Androidå¼€å‘è€…  
**æ¼”è®²æ—¶é•¿**: 120åˆ†é’Ÿ  
**æ ¸å¿ƒé‡ç‚¹**: **è¿›ç¨‹å†…å­˜ç©ºé—´çš„å®Œæ•´å‰–æ**

### ğŸ¯ æœ€ç»ˆä¼˜åŒ–åçš„ä¸‰å±‚ç»“æ„

```
ğŸ”¬ æ˜¾å¾®é•œè§†è§’ï¼šè¿›ç¨‹ç©ºé—´ä¸ºç»å¯¹æ ¸å¿ƒ

ç¬¬ä¸€å±‚ (40x)ï¼šJavaå †å¿«é€Ÿå®šä½                    (15åˆ†é’Ÿ) âœ…
â”œâ”€ æç®€å›é¡¾ï¼šval user = User() å¯¹è±¡åœ¨å“ªé‡Œ
â”œâ”€ æ ¸å¿ƒç›®æ ‡ï¼šå¿«é€Ÿè¿‡æ¸¡åˆ°è¿›ç¨‹ç©ºé—´å±‚é¢
â””â”€ å¼•å¯¼é‡ç‚¹ï¼šJavaå †åªæ˜¯è¿›ç¨‹ç©ºé—´çš„ä¸€å°éƒ¨åˆ† â˜…

ç¬¬äºŒå±‚ (400x)ï¼šè¿›ç¨‹ç©ºé—´æ·±åº¦å‰–æ ã€æ¼”è®²æ ¸å¿ƒã€‘    (50åˆ†é’Ÿ) â­
â”œâ”€ è™šæ‹Ÿåœ°å€ç©ºé—´çš„å®Œæ•´å¸ƒå±€å‰–æ
â”œâ”€ ä¸‰å±‚å †åµŒå¥—å…³ç³»çš„æ·±åº¦è§£æ 
â”œâ”€ Zygoteè¿›ç¨‹å·¥å‚ä¸Copy-On-Writeæœºåˆ¶
â”œâ”€ çº¿ç¨‹æ ˆå·®å¼‚ä¸å†…å­˜åˆ†é…ç­–ç•¥
â”œâ”€ Android 8æ¶æ„å˜é©çš„åº•å±‚åŸç†
â”œâ”€ æ±‡ç¼–çº§vså­—èŠ‚ç çº§çš„å†…å­˜ç®¡ç†å¯¹æ¯”
â””â”€ ActivityåŠ è½½å›¾ç‰‡çš„å®Œæ•´å†…å­˜äº¤äº’æµç¨‹

ç¬¬ä¸‰å±‚ (4000x)ï¼šç¡¬ä»¶åŸºç¡€ä¸ä¼˜åŒ–               (20åˆ†é’Ÿ)  
â”œâ”€ ç‰©ç†å†…å­˜ç¡¬ä»¶æ¶æ„åŸºç¡€
â”œâ”€ è™šæ‹Ÿå†…å­˜æ˜ å°„æœºåˆ¶ç²¾è¦
â””â”€ ç¡¬ä»¶ç‰¹æ€§å¯¼å‘çš„æ€§èƒ½ä¼˜åŒ–ç­–ç•¥
```

---

## ğŸ“‹ é‡æ–°è°ƒæ•´çš„æ—¶é—´å®‰æ’

```
00:00-10:00  å¼€åœºï¼šä¸€è¡Œä»£ç å¼•å‘çš„è¿›ç¨‹ç©ºé—´æ¢ç´¢      (10åˆ†é’Ÿ)
10:00-25:00  ç¬¬ä¸€å±‚ï¼šJavaå †å¿«é€Ÿå®šä½              (15åˆ†é’Ÿ)
25:00-30:00  å±‚çº§è½¬æ¢ï¼šèšç„¦è¿›ç¨‹ç©ºé—´               (5åˆ†é’Ÿ)
30:00-80:00  ç¬¬äºŒå±‚ï¼šè¿›ç¨‹ç©ºé—´æ·±åº¦å‰–æã€é‡ç‚¹ã€‘      (50åˆ†é’Ÿ)
80:00-85:00  å±‚çº§è½¬æ¢ï¼šä»è™šæ‹Ÿåˆ°ç‰©ç†               (5åˆ†é’Ÿ)
85:00-105:00 ç¬¬ä¸‰å±‚ï¼šç¡¬ä»¶æ¶æ„ä¸ä¼˜åŒ–               (20åˆ†é’Ÿ)
105:00-120:00 æ€»ç»“ï¼šè¿›ç¨‹ç©ºé—´çš„å®Œæ•´è®¤çŸ¥             (15åˆ†é’Ÿ)
```

---

# ğŸš€ å¼€åœºï¼šä¸€è¡Œä»£ç å¼•å‘çš„è¿›ç¨‹ç©ºé—´æ¢ç´¢ (10åˆ†é’Ÿ)

## ä»ç†Ÿæ‚‰çš„ä»£ç å¼€å§‹ï¼Œèšç„¦è¿›ç¨‹ç©ºé—´

å„ä½åŒäº‹ï¼Œå¤§å®¶å¥½ï¼ä»Šå¤©æˆ‘ä»¬è¦æ·±å…¥æ¢ç´¢Androidè¿›ç¨‹å†…å­˜ç©ºé—´çš„å¥¥ç§˜ã€‚

### æˆ‘ä»¬çš„èµ·ç‚¹ï¼šä¸€è¡Œä»£ç èƒŒåçš„ç©ºé—´ç§˜å¯†

```kotlin
val user = User("Android Developer")
```

**æ ¸å¿ƒé—®é¢˜** ğŸ¯ï¼šè¿™ä¸ªUserå¯¹è±¡ä¸ä»…ä»…æ˜¯"å­˜åœ¨å †é‡Œ"è¿™ä¹ˆç®€å•ï¼Œå®ƒèƒŒåéšè—ç€Androidè¿›ç¨‹ç©ºé—´çš„å®Œæ•´æ¶æ„ï¼

### ğŸ”¬ ä»Šå¤©çš„é‡ç‚¹ï¼šè¿›ç¨‹ç©ºé—´çš„æ˜¾å¾®é•œè§£å‰–

æˆ‘ä»¬å°†ç”¨æ˜¾å¾®é•œçš„æ–¹å¼ï¼Œ**é‡ç‚¹å‰–æè¿›ç¨‹ç©ºé—´**ï¼š

#### ğŸ¯ é‡ç‚¹å†…å®¹é¢„å‘Š

**âš¡ æ ¸å¿ƒå‘ç°**ï¼š
1. **ä¸‰å±‚å †çš„åµŒå¥—ç§˜å¯†** - è¿›ç¨‹å †æ®µâŠƒNativeå †âŠƒARTå †
2. **Zygoteçš„è¿›ç¨‹å·¥å‚æœºåˆ¶** - ä¸ºä»€ä¹ˆAndroidå¯åŠ¨è¿™ä¹ˆå¿«ï¼Ÿ
3. **è™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€** - 4GBç©ºé—´æ˜¯å¦‚ä½•åˆ†é…çš„ï¼Ÿ
4. **çº¿ç¨‹æ ˆvsè¿›ç¨‹å †** - ä¸»çº¿ç¨‹ä¸ºä»€ä¹ˆç‰¹æ®Šï¼Ÿ
5. **Android 8çš„æ¶æ„é©å‘½** - å›¾ç‰‡å†…å­˜ä¸ºä»€ä¹ˆè¦æ¬å®¶ï¼Ÿ

**â±ï¸ æœ€ç»ˆæ—¶é—´åˆ†é…**ï¼š
- Javaå †å®šä½ï¼š15åˆ†é’Ÿï¼ˆç®€åŒ–ä¸ºå¿«é€Ÿè¿‡æ¸¡ï¼‰
- **è¿›ç¨‹ç©ºé—´å‰–æï¼š50åˆ†é’Ÿï¼ˆç»å¯¹æ ¸å¿ƒé‡ç‚¹ï¼Œæ·±åº¦å±•å¼€ï¼‰**
- ç¡¬ä»¶åŸºç¡€ï¼š20åˆ†é’Ÿï¼ˆä¼˜åŒ–å®è·µå¯¼å‘ï¼‰

ç°åœ¨ï¼Œè®©æˆ‘ä»¬å¼€å§‹è¿™åœºä»¥è¿›ç¨‹ç©ºé—´ä¸ºæ ¸å¿ƒçš„æ·±åº¦æ¢ç´¢ï¼

---

# ğŸ”¬ ç¬¬ä¸€å±‚ï¼šJavaå †å¿«é€Ÿå®šä½ (40xæ”¾å¤§) (15åˆ†é’Ÿ)

## 1.1 å¿«é€Ÿå®šä½ï¼šUserå¯¹è±¡åœ¨Javaå †ä¸­çš„ä½ç½® (8åˆ†é’Ÿ)

### æ˜¾å¾®é•œèšç„¦ï¼šç›´å¥”ä¸»é¢˜

æˆ‘ä»¬å¿«é€Ÿå®šä½Userå¯¹è±¡çš„å­˜å‚¨ä½ç½®ï¼Œä¸ºåç»­çš„è¿›ç¨‹ç©ºé—´åˆ†æåšå¥½é“ºå«ï¼š

```kotlin
class QuickJavaHeapLocation {
    
    fun locateUserObjectFast() {
        Log.d("QuickLocate", "ğŸ”¬ 40xå¿«é€Ÿå®šä½ï¼šUserå¯¹è±¡åœ¨Javaå †ä¸­çš„ä½ç½®")
        
        // åˆ›å»ºå¯¹è±¡å¹¶ç«‹å³è§‚å¯Ÿ
        val user = User("Quick Demo")  // â† å¯¹è±¡åˆ†é…åˆ°EdenåŒº
        
        // å¿«é€ŸéªŒè¯å†…å­˜åˆ†é…
        val runtime = Runtime.getRuntime()
        val beforeMemory = (runtime.totalMemory() - runtime.freeMemory()) / 1024
        
        // æ‰¹é‡åˆ›å»ºè§‚å¯Ÿå†…å­˜å¢é•¿
        val users = Array(1000) { User("User$it") }
        
        val afterMemory = (runtime.totalMemory() - runtime.freeMemory()) / 1024
        
        Log.d("QuickLocate", """
            |ğŸ“ å¿«é€Ÿå®šä½ç»“æœï¼š
            |  Userå¯¹è±¡ä½ç½®ï¼šJavaå † â†’ EdenåŒºï¼ˆæ–°ç”Ÿä»£ï¼‰
            |  å†…å­˜å¢é•¿ï¼š${afterMemory - beforeMemory}KB
            |  å¯¹è±¡æ•°é‡ï¼š${users.size}ä¸ª
            |  
            |ğŸ’¡ å…³é”®å‘ç°ï¼šUserå¯¹è±¡ç¡®å®åœ¨Javaå †ä¸­
            |ğŸ¯ æ¥ä¸‹æ¥é‡ç‚¹ï¼šJavaå †åœ¨è¿›ç¨‹ç©ºé—´ä¸­çš„ä½ç½®ï¼
        """.trimMargin())
    }
}
```

### ğŸ” Memory Profilerå¿«é€ŸéªŒè¯

**ç°åœºæ¼”ç¤ºè¦ç‚¹**ï¼š
1. **å¯åŠ¨Memory Profiler**
2. **è¿è¡Œä»£ç ï¼Œè§‚å¯ŸJava/Kotlinå†…å­˜å¢é•¿**
3. **é‡ç‚¹å…³æ³¨**ï¼šJavaå †åªæ˜¯å†…å­˜çš„ä¸€å°éƒ¨åˆ†

```
ğŸ“Š Memory Profilerè§‚å¯Ÿé‡ç‚¹ï¼š

Java/Kotlin: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ (ä½ çœ‹åˆ°çš„Javaå †)
Native:       â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ (æ›´å¤§çš„Nativeå †)
Graphics:     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ (GPUå†…å­˜)
Stack:        â–ˆâ–ˆâ–‘â–‘ (çº¿ç¨‹æ ˆ)
Code:         â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ (ä»£ç æ®µ)

ğŸ’¡ å‘ç°ï¼šJavaå †åªæ˜¯è¿›ç¨‹å†…å­˜çš„ä¸€éƒ¨åˆ†ï¼
```

## 1.2 GCæœºåˆ¶ç®€è¦å›é¡¾ (4åˆ†é’Ÿ)

### é‡ç‚¹ï¼šGCå¯¹è¿›ç¨‹ç©ºé—´çš„å½±å“

```kotlin
class GCImpactOnProcessSpace {
    
    fun observeGCProcessImpact() {
        Log.d("GCImpact", "âš¡ GCå¯¹è¿›ç¨‹ç©ºé—´çš„å½±å“")
        
        val memInfo = Debug.MemoryInfo()
        
        // GCå‰çŠ¶æ€
        Debug.getMemoryInfo(memInfo)
        val beforeTotal = memInfo.totalPss
        val beforeJava = memInfo.dalvikHeap
        
        // åˆ›å»ºå¤§é‡å¯¹è±¡è§¦å‘GC
        repeat(5) {
            val tempObjects = Array(500) { User("GC_$it") }
            System.gc()
        }
        
        // GCåçŠ¶æ€
        Thread.sleep(1000)
        Debug.getMemoryInfo(memInfo)
        val afterTotal = memInfo.totalPss
        val afterJava = memInfo.dalvikHeap
        
        Log.d("GCImpact", """
            |ğŸ“Š GCå¯¹è¿›ç¨‹ç©ºé—´çš„å½±å“ï¼š
            |  è¿›ç¨‹æ€»å†…å­˜ï¼š${beforeTotal}KB â†’ ${afterTotal}KB
            |  Javaå †å†…å­˜ï¼š${beforeJava}KB â†’ ${afterJava}KB
            |  
            |ğŸ’¡ å…³é”®è§‚å¯Ÿï¼š
            |  - GCä¸»è¦å½±å“Javaå †éƒ¨åˆ†
            |  - è¿›ç¨‹æ€»å†…å­˜å˜åŒ–ç›¸å¯¹è¾ƒå°
            |  - è¯´æ˜Javaå †æ˜¯è¿›ç¨‹ç©ºé—´çš„å­é›†ï¼
        """.trimMargin())
    }
}
```

## 1.3 å¿«é€Ÿæ€»ç»“ï¼šæŒ‡å‘è¿›ç¨‹ç©ºé—´ (3åˆ†é’Ÿ)

### ğŸ¯ å…³é”®è½¬æ¢ç‚¹

```kotlin
class TransitionToProcessSpace {
    
    fun pointToProcessSpace() {
        Log.d("Transition", """
            |ğŸ¯ Javaå †å®šä½æ€»ç»“ï¼š
            |
            |âœ… å·²ç¡®è®¤ï¼šUserå¯¹è±¡å­˜åœ¨Javaå †çš„EdenåŒº
            |âœ… å·²è§‚å¯Ÿï¼šJavaå †å—GCç®¡ç†ï¼Œæœ‰è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ
            |âœ… å·²å‘ç°ï¼šJavaå †åªæ˜¯è¿›ç¨‹å†…å­˜çš„ä¸€éƒ¨åˆ†
            |
            |ğŸ” å…³é”®é—®é¢˜å¼•å‡ºï¼š
            |  1. Javaå †åœ¨è¿›ç¨‹ç©ºé—´ä¸­å å¤šå¤§æ¯”ä¾‹ï¼Ÿ
            |  2. Javaå †å‘¨å›´è¿˜æœ‰ä»€ä¹ˆå†…å­˜åŒºåŸŸï¼Ÿ
            |  3. ä¸ºä»€ä¹ˆè¯´æœ‰"ä¸‰å±‚å †"çš„åµŒå¥—å…³ç³»ï¼Ÿ
            |  4. è¿›ç¨‹ç©ºé—´æ˜¯å¦‚ä½•å¸ƒå±€å’Œç®¡ç†çš„ï¼Ÿ
            |
            |ğŸš€ æ¥ä¸‹æ¥é‡ç‚¹ï¼š
            |  è°ƒæ•´æ˜¾å¾®é•œåˆ°400xï¼Œæ·±å…¥å‰–æè¿›ç¨‹ç©ºé—´ï¼
        """.trimMargin())
    }
}
```

---

# ğŸ”„ å±‚çº§è½¬æ¢ï¼šèšç„¦è¿›ç¨‹ç©ºé—´ (5åˆ†é’Ÿ)

## ğŸ”¬ æ˜¾å¾®é•œè°ƒæ•´ï¼šä»40xåˆ°400x

### è§†è§’è½¬æ¢ï¼šä»Javaå †åˆ°æ•´ä¸ªè¿›ç¨‹ç”Ÿæ€

```kotlin
class FocusOnProcessSpace {
    
    fun transitionToProcessSpaceFocus() {
        Log.d("Focus", "ğŸ”¬ æ˜¾å¾®é•œè°ƒæ•´ï¼šèšç„¦è¿›ç¨‹ç©ºé—´åˆ†æ")
        
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        
        Log.d("Focus", """
            |ğŸ¯ è§†è§’è½¬æ¢ï¼šä»Javaå †åˆ°è¿›ç¨‹ç©ºé—´
            |
            |40xè§†è§’ï¼ˆåˆšæ‰çœ‹åˆ°çš„ï¼‰ï¼š
            |  Userå¯¹è±¡ â†’ Javaå † â†’ EdenåŒº
            |
            |400xè§†è§’ï¼ˆç°åœ¨è¦çœ‹çš„ï¼‰ï¼š
            |  Javaå † â†’ è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ â†’ å®Œæ•´å¸ƒå±€
            |
            |ğŸ“Š è¿›ç¨‹å†…å­˜å…¨æ™¯é¢„è§ˆï¼š
            |  æ€»è¿›ç¨‹å†…å­˜: ${memInfo.totalPss}KB
            |  â”œâ”€ Javaå †: ${memInfo.dalvikHeap}KB (${memInfo.dalvikHeap * 100 / memInfo.totalPss}%)
            |  â”œâ”€ Nativeå †: ${memInfo.nativeHeap}KB (${memInfo.nativeHeap * 100 / memInfo.totalPss}%)
            |  â”œâ”€ ä»£ç æ®µ: ${memInfo.code}KB 
            |  â”œâ”€ æ ˆç©ºé—´: ${memInfo.stack}KB
            |  â”œâ”€ Graphics: ${memInfo.graphics}KB
            |  â””â”€ å…¶ä»–: ${memInfo.totalPss - memInfo.dalvikHeap - memInfo.nativeHeap - memInfo.code - memInfo.stack - memInfo.graphics}KB
            |
            |ğŸš€ é‡ç‚¹å‘ç°ï¼šJavaå †åªå è¿›ç¨‹å†…å­˜çš„${memInfo.dalvikHeap * 100 / memInfo.totalPss}%ï¼
            |   è¿˜æœ‰${100 - memInfo.dalvikHeap * 100 / memInfo.totalPss}%çš„ç©ºé—´ç­‰å¾…æˆ‘ä»¬æ¢ç´¢ï¼
        """.trimMargin())
        
        Log.d("Focus", """
            |ğŸ¯ æ¥ä¸‹æ¥50åˆ†é’Ÿé‡ç‚¹å†…å®¹ï¼š
            |  1. è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å®Œæ•´å¸ƒå±€ï¼ˆ15åˆ†é’Ÿï¼‰
            |  2. ä¸‰å±‚å †åµŒå¥—å…³ç³»çš„æ·±åº¦å‰–æï¼ˆ15åˆ†é’Ÿï¼‰
            |  3. Zygoteæœºåˆ¶ä¸è¿›ç¨‹åˆ›å»ºï¼ˆ10åˆ†é’Ÿï¼‰
            |  4. Androidç‰¹æœ‰çš„å†…å­˜ç®¡ç†ç‰¹æ€§ï¼ˆ10åˆ†é’Ÿï¼‰
        """.trimMargin())
    }
}
```

---

# ğŸ—ï¸ ç¬¬äºŒå±‚ï¼šè¿›ç¨‹ç©ºé—´æ·±åº¦å‰–æã€æ¼”è®²é‡ç‚¹ã€‘ (400xæ”¾å¤§) (50åˆ†é’Ÿ)

## 2.1 è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å®Œæ•´å¸ƒå±€ (15åˆ†é’Ÿ)

### ğŸ”¬ 400xæ˜¾å¾®é•œä¸‹çš„å®Œæ•´ç”Ÿæ€ç³»ç»Ÿ

è¿›ç¨‹ç©ºé—´å°±åƒä¸€åº§ç²¾å¿ƒè®¾è®¡çš„æ‘©å¤©å¤§æ¥¼ï¼Œæ¯ä¸€å±‚éƒ½æœ‰ç‰¹å®šçš„åŠŸèƒ½ï¼š

```kotlin
class ProcessVirtualAddressSpace {
    
    fun exploreCompleteLayout() {
        Log.d("ProcessLayout", "ğŸ”¬ 400xè§†è§’ï¼šè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å®Œæ•´å¸ƒå±€")
        
        val processId = android.os.Process.myPid()
        
        Log.d("ProcessLayout", """
            |ğŸ—ï¸ Androidè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´å¸ƒå±€ (32ä½ç¤ºä¾‹)ï¼š
            |
            |  è™šæ‹Ÿåœ°å€èŒƒå›´            å†…å­˜åŒºåŸŸ              åŠŸèƒ½æè¿°
            |  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            |  0xFFFFFFFF            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |                        â”‚  Kernel Space   â”‚  å†…æ ¸ç©ºé—´ (1GB)
            |                        â”‚   (ç³»ç»Ÿå†…æ ¸)     â”‚  â”œâ”€ ç³»ç»Ÿè°ƒç”¨å¤„ç†
            |  0xC0000000            â”‚                â”‚  â”œâ”€ ä¸­æ–­å¤„ç†
            |                        â”‚                â”‚  â””â”€ å†…æ ¸æ•°æ®ç»“æ„
            |                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚                â”‚
            |                        â”‚   User Space    â”‚  ç”¨æˆ·ç©ºé—´ (3GB)
            |                        â”‚  (åº”ç”¨ç¨‹åº)      â”‚  â† æˆ‘ä»¬çš„Appåœ¨è¿™é‡Œ
            |                        â”‚                â”‚
            |  0xBFFFFFFF            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚     Stack       â”‚  æ ˆç©ºé—´
            |  0xB0000000            â”‚   (å‘ä¸‹å¢é•¿)     â”‚  â”œâ”€ æ–¹æ³•è°ƒç”¨æ ˆ
            |                        â”‚                â”‚  â”œâ”€ å±€éƒ¨å˜é‡
            |                        â”‚  [çº¿ç¨‹æ ˆç©ºé—´]    â”‚  â””â”€ æ–¹æ³•å‚æ•°
            |  0xA0000000            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚                â”‚
            |                        â”‚ Memory Mapping  â”‚  å†…å­˜æ˜ å°„åŒº
            |  0x40000000            â”‚ (å…±äº«åº“åŒºåŸŸ)     â”‚  â”œâ”€ Android Framework
            |                        â”‚                â”‚  â”œâ”€ libart.so
            |                        â”‚  [.soæ–‡ä»¶]      â”‚  â”œâ”€ libc.so
            |                        â”‚                â”‚  â””â”€ åº”ç”¨çš„nativeåº“
            |                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚                â”‚
            |                        â”‚                â”‚
            |                        â”‚     HEAP        â”‚  å †ç©ºé—´ã€é‡ç‚¹ã€‘
            |                        â”‚   (å‘ä¸Šå¢é•¿)     â”‚  â”œâ”€ Javaå † (ART)
            |  0x08048000            â”‚                â”‚  â”œâ”€ Nativeå † (malloc)
            |                        â”‚ [Userå¯¹è±¡åœ¨è¿™é‡Œ] â”‚  â””â”€ å…¶ä»–åŠ¨æ€åˆ†é…
            |                        â”‚                â”‚
            |                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚  Data Segment   â”‚  æ•°æ®æ®µ
            |  0x08000000            â”‚                â”‚  â”œâ”€ å…¨å±€å˜é‡
            |                        â”‚ [å…¨å±€å˜é‡å­˜å‚¨]   â”‚  â””â”€ é™æ€å˜é‡
            |                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
            |                        â”‚  Code Segment   â”‚  ä»£ç æ®µ
            |  0x00400000            â”‚                â”‚  â”œâ”€ ç¼–è¯‘åçš„ä»£ç 
            |                        â”‚   [ç¨‹åºä»£ç ]    â”‚  â””â”€ å¸¸é‡å­—ç¬¦ä¸²
            |  0x00000000            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |  ğŸ“ Userå¯¹è±¡çš„å®Œæ•´è·¯å¾„ï¼š
            |     è™šæ‹Ÿåœ°å€0x08048000+ â†’ HEAPåŒºåŸŸ â†’ Javaå † â†’ EdenåŒº â†’ Userå¯¹è±¡
        """.trimMargin())
        
        // å®é™…æµ‹é‡å„ä¸ªåŒºåŸŸ
        measureProcessRegions()
    }
    
    private fun measureProcessRegions() {
        Log.d("ProcessLayout", "ğŸ“Š å®é™…æµ‹é‡å„ä¸ªåŒºåŸŸçš„ä½¿ç”¨æƒ…å†µ")
        
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        
        // åˆ›å»ºæµ‹è¯•æ•°æ®æ¥è§‚å¯Ÿä¸åŒåŒºåŸŸçš„å˜åŒ–
        val beforeMeasurement = getCurrentProcessMemory()
        
        // 1. æµ‹è¯•å †åŒºåŸŸå˜åŒ–
        val heapTestObjects = Array(1000) { User("Heap_$it") }
        
        // 2. æµ‹è¯•æ ˆåŒºåŸŸå˜åŒ–ï¼ˆé€šè¿‡é€’å½’ï¼‰
        fun testStackGrowth(depth: Int) {
            val stackLocalArray = IntArray(500) { it }  // æ ˆä¸­åˆ†é…
            if (depth > 1) testStackGrowth(depth - 1)
        }
        testStackGrowth(20)
        
        // 3. æµ‹è¯•Nativeå †å˜åŒ–
        val nativeBitmap = Bitmap.createBitmap(1024, 1024, Bitmap.Config.ARGB_8888)
        
        val afterMeasurement = getCurrentProcessMemory()
        
        Log.d("ProcessLayout", """
            |ğŸ“Š å„åŒºåŸŸå®é™…ä½¿ç”¨å˜åŒ–ï¼š
            |
            |  åŒºåŸŸç±»å‹          åˆ†é…å‰        åˆ†é…å        å˜åŒ–é‡
            |  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€
            |  è¿›ç¨‹æ€»å†…å­˜        ${beforeMeasurement.totalPss}KB      ${afterMeasurement.totalPss}KB      +${afterMeasurement.totalPss - beforeMeasurement.totalPss}KB
            |  Javaå †(ART)     ${beforeMeasurement.dalvikHeap}KB      ${afterMeasurement.dalvikHeap}KB      +${afterMeasurement.dalvikHeap - beforeMeasurement.dalvikHeap}KB  â† heapTestObjectsåœ¨è¿™é‡Œ
            |  Nativeå †        ${beforeMeasurement.nativeHeap}KB      ${afterMeasurement.nativeHeap}KB      +${afterMeasurement.nativeHeap - beforeMeasurement.nativeHeap}KB  â† nativeBitmapåœ¨è¿™é‡Œ
            |  æ ˆç©ºé—´          ${beforeMeasurement.stack}KB        ${afterMeasurement.stack}KB        +${afterMeasurement.stack - beforeMeasurement.stack}KB    â† stackLocalArrayåœ¨è¿™é‡Œ
            |  ä»£ç æ®µ          ${beforeMeasurement.code}KB         ${afterMeasurement.code}KB         +${afterMeasurement.code - beforeMeasurement.code}KB
            |
            |ğŸ’¡ å…³é”®å‘ç°ï¼š
            |  - ä¸åŒç±»å‹çš„å¯¹è±¡ç¡®å®åˆ†é…åˆ°ä¸åŒçš„å†…å­˜åŒºåŸŸ
            |  - Javaå¯¹è±¡(User) â†’ Javaå †åŒºåŸŸ
            |  - Nativeå¯¹è±¡(Bitmapåƒç´ ) â†’ Nativeå †åŒºåŸŸ  
            |  - å±€éƒ¨å˜é‡(æ•°ç»„) â†’ æ ˆåŒºåŸŸ
        """.trimMargin())
        
        // ä¿æŒå¼•ç”¨ï¼Œé˜²æ­¢è¢«ä¼˜åŒ–æ‰
        Log.d("ProcessLayout", "æµ‹è¯•å¯¹è±¡ï¼šJava=${heapTestObjects.size}, Native=${nativeBitmap.width}x${nativeBitmap.height}")
    }
    
    private fun getCurrentProcessMemory(): Debug.MemoryInfo {
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        return memInfo
    }
}
```

### ğŸ¯ é‡ç‚¹è§‚å¯Ÿï¼šè™šæ‹Ÿåœ°å€ç©ºé—´çš„å®é™…æŸ¥çœ‹

```kotlin
class VirtualAddressObservation {
    
    fun observeActualVirtualAddressSpace() {
        val processId = android.os.Process.myPid()
        
        Log.d("VirtualAddress", """
            |ğŸ” å®é™…æŸ¥çœ‹è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š
            |
            |ğŸ’» æ‰§è¡Œå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹${processId}çš„å†…å­˜æ˜ å°„ï¼š
            |  adb shell cat /proc/$processId/maps
            |
            |ğŸ“– è¾“å‡ºè§£è¯»ç¤ºä¾‹ï¼š
            |  12c00000-52c00000 rw-p 00000000 00:00 0    [anon:libc_malloc]
            |  ^^^^^^^^ ^^^^^^^^ ^^^^ ^^^^^^^^ ^^^^^ ^    ^^^^^^^^^^^^^^^
            |  èµ·å§‹åœ°å€  ç»“æŸåœ°å€  æƒé™   åç§»    è®¾å¤‡  inode    æè¿°
            |
            |ğŸ” å…³é”®æ˜ å°„åŒºåŸŸè¯†åˆ«ï¼š
            |  [heap]                    â† è¿›ç¨‹ä¸»å †æ®µ
            |  [anon:libc_malloc]        â† Nativeå †åˆ†é…åŒºåŸŸ
            |  [anon:dalvik-main space]  â† ART Javaå †ä¸»ç©ºé—´
            |  [stack]                   â† ä¸»çº¿ç¨‹æ ˆ
            |  libart.so                 â† ARTè™šæ‹Ÿæœºåº“
            |  libandroid_runtime.so     â† Androidè¿è¡Œæ—¶åº“
            |
            |ğŸ’¡ ç°åœºæ¼”ç¤ºè¦ç‚¹ï¼š
            |  1. æ‰¾åˆ°dalvik-main spaceçš„åœ°å€èŒƒå›´
            |  2. ç¡®è®¤è¿™å°±æ˜¯æˆ‘ä»¬Userå¯¹è±¡æ‰€åœ¨çš„Javaå †
            |  3. è§‚å¯Ÿå®ƒåœ¨æ•´ä¸ª4GBè™šæ‹Ÿç©ºé—´ä¸­çš„å…·ä½“ä½ç½®
        """.trimMargin())
        
        // åˆ›å»ºå¯¹è±¡æ¥å½±å“å†…å­˜æ˜ å°„ï¼Œä¾¿äºè§‚å¯Ÿ
        createObjectsForMapping()
        
        Log.d("VirtualAddress", """
            |ğŸ¯ ç°åœ¨å†æ¬¡æ‰§è¡Œå‘½ä»¤ï¼Œè§‚å¯Ÿå†…å­˜æ˜ å°„çš„å˜åŒ–ï¼š
            |  adb shell cat /proc/$processId/maps | grep -E "(heap|dalvik|malloc)"
            |
            |ğŸ“Š é¢„æœŸè§‚å¯Ÿç»“æœï¼š
            |  - dalvik-main spaceçš„å¤§å°å¯èƒ½å¢åŠ 
            |  - libc_mallocåŒºåŸŸå¯èƒ½æœ‰æ–°çš„åˆ†é…
            |  - æ€»çš„è™šæ‹Ÿåœ°å€ä½¿ç”¨èŒƒå›´å¯èƒ½æ‰©å¤§
        """.trimMargin())
    }
    
    private fun createObjectsForMapping() {
        // åˆ›å»ºè¶³å¤Ÿå¤šçš„å¯¹è±¡æ¥å½±å“å†…å­˜æ˜ å°„
        val javaObjects = Array(5000) { User("Mapping_$it") }
        val nativeObjects = Array(3) { 
            Bitmap.createBitmap(1024, 1024, Bitmap.Config.ARGB_8888)
        }
        
        Log.d("VirtualAddress", "åˆ›å»ºå¯¹è±¡ç”¨äºè§‚å¯Ÿå†…å­˜æ˜ å°„å˜åŒ–ï¼šJava=${javaObjects.size}, Native=${nativeObjects.size}")
    }
}

data class User(val name: String) {
    val id: Long = System.currentTimeMillis()
    val data: ByteArray = ByteArray(512) { it.toByte() }  // 512å­—èŠ‚æ•°æ®
}
```

## 2.2 ä¸‰å±‚å †åµŒå¥—å…³ç³»æ·±åº¦å‰–æã€æ ¸å¿ƒé‡ç‚¹ã€‘ (15åˆ†é’Ÿ)

### ğŸ”¬ æœ€é‡è¦çš„å‘ç°ï¼šå †çš„ä¸‰å±‚åµŒå¥—ç»“æ„

è¿™æ˜¯ä»Šå¤©æ¼”è®²çš„æ ¸å¿ƒå‘ç°ï¼è®©æˆ‘ä»¬æ·±å…¥å‰–æä¸‰å±‚å †çš„åµŒå¥—å…³ç³»ï¼š

```kotlin
class ThreeLayerHeapAnalysis {
    
    fun exploreThreeLayerHeapStructure() {
        Log.d("ThreeLayer", "ğŸ”¬ æ ¸å¿ƒå‘ç°ï¼šå †çš„ä¸‰å±‚åµŒå¥—ç»“æ„æ·±åº¦å‰–æ")
        
        // ç¬¬ä¸€å±‚ï¼šè¿›ç¨‹å †æ®µ - "åœŸåœ°"
        analyzeProcessHeapSegment()
        
        // ç¬¬äºŒå±‚ï¼šNativeå † - "å»ºç­‘"
        analyzeNativeHeapLayer()
        
        // ç¬¬ä¸‰å±‚ï¼šART Javaå † - "è£…ä¿®"
        analyzeARTJavaHeapLayer()
        
        // éªŒè¯ä¸‰å±‚åµŒå¥—å…³ç³»
        verifyNestedRelationship()
        
        // é‡ç‚¹ï¼šAndroid 8çš„æ¶æ„å˜åŒ–
        exploreAndroid8Changes()
    }
    
    private fun analyzeProcessHeapSegment() {
        Log.d("ThreeLayer", """
            |ğŸ—ï¸ ç¬¬ä¸€å±‚ï¼šè¿›ç¨‹å †æ®µ - "æ”¿åºœåˆ†é…çš„åœŸåœ°"
            |
            |  è¿™æ˜¯Linuxå†…æ ¸ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…çš„è™šæ‹Ÿå†…å­˜ç©ºé—´åŸºç¡€
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                Process Heap Segment                    â”‚
            |  â”‚           (Virtual Address: 0x08048000+)               â”‚
            |  â”‚                                                        â”‚
            |  â”‚    â”Œâ”€ è¿™æ˜¯æ‰€æœ‰åŠ¨æ€åˆ†é…å†…å­˜çš„"åœŸåœ°"                      â”‚
            |  â”‚    â”œâ”€ é€šè¿‡ç³»ç»Ÿè°ƒç”¨ brk() å’Œ mmap() æ‰©å±•                â”‚
            |  â”‚    â”œâ”€ ç”±Linuxå†…æ ¸çš„å†…å­˜ç®¡ç†å™¨åˆ†é…                       â”‚
            |  â”‚    â””â”€ æ˜¯Nativeå †å’ŒJavaå †çš„ç‰©ç†åŸºç¡€                     â”‚
            |  â”‚                                                        â”‚
            |  â”‚  æ‰€æœ‰çš„malloc()ã€newæ“ä½œéƒ½å¿…é¡»åœ¨è¿™å—"åœŸåœ°"ä¸Šè¿›è¡Œ        â”‚
            |  â”‚                                                        â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |        â†‘
            |        é€šè¿‡MMUæ˜ å°„åˆ°å®é™…çš„ç‰©ç†RAM
            |
            |ğŸ“Š è¿›ç¨‹å †æ®µç‰¹å¾ï¼š
            |  - ç®¡ç†è€…ï¼šLinuxå†…æ ¸
            |  - æ‰©å±•æ–¹å¼ï¼šbrk() å‘ä¸Šæ‰©å±•ï¼Œmmap() åœ¨æ˜ å°„åŒºåˆ†é…
            |  - å®¹é‡ï¼šç†è®ºä¸Šå¯è¾¾3GB (32ä½ç³»ç»Ÿç”¨æˆ·ç©ºé—´)
            |  - ä½œç”¨ï¼šä¸ºæ‰€æœ‰å…¶ä»–å †æä¾›è™šæ‹Ÿå†…å­˜åŸºç¡€
        """.trimMargin())
        
        // æ¼”ç¤ºè¿›ç¨‹å †æ®µçš„æŸ¥çœ‹æ–¹æ³•
        val processId = android.os.Process.myPid()
        Log.d("ThreeLayer", """
            |ğŸ’» æŸ¥çœ‹ç¬¬ä¸€å±‚ - è¿›ç¨‹å †æ®µï¼š
            |  å‘½ä»¤ï¼šadb shell cat /proc/$processId/maps | grep heap
            |  è¾“å‡ºç¤ºä¾‹ï¼š08048000-20000000 rw-p 00000000 00:00 0 [heap]
            |           ^^^^^^^^ ^^^^^^^^                        â†‘
            |           èµ·å§‹åœ°å€   ç»“æŸåœ°å€                     å †æ ‡è¯†
            |
            |ğŸ¯ è¿™å°±æ˜¯æˆ‘ä»¬æ‰€æœ‰å†…å­˜åˆ†é…çš„"åœŸåœ°è¾¹ç•Œ"ï¼
        """.trimMargin())
    }
    
    private fun analyzeNativeHeapLayer() {
        Log.d("ThreeLayer", """
            |ğŸ”§ ç¬¬äºŒå±‚ï¼šNativeå † - "ä¸“ä¸šçš„å»ºç­‘æ‰¿åŒ…å•†"
            |
            |  åœ¨è¿›ç¨‹å †æ®µçš„åŸºç¡€ä¸Šï¼Œç”±C/C++è¿è¡Œæ—¶åº“æ„å»ºçš„å†…å­˜ç®¡ç†å±‚
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                Process Heap Segment                    â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚                  Native Heap                      â”‚  â”‚
            |  â”‚  â”‚            (malloc/free ç®¡ç†)                     â”‚  â”‚
            |  â”‚  â”‚                                                   â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
            |  â”‚  â”‚  â”‚  C++å¯¹è±¡    â”‚  â”‚  JNIå†…å­˜    â”‚  â”‚  å›¾ç‰‡åƒç´    â”‚  â”‚  â”‚
            |  â”‚  â”‚  â”‚   malloc    â”‚  â”‚   malloc    â”‚  â”‚  (Android8+)â”‚  â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
            |  â”‚  â”‚                                                   â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
            |  â”‚  â”‚  â”‚ å°å—å†…å­˜æ±   â”‚  â”‚ ä¸­ç­‰å†…å­˜æ±   â”‚  â”‚ å¤§å—å†…å­˜æ±   â”‚  â”‚  â”‚
            |  â”‚  â”‚  â”‚  (32å­—èŠ‚)   â”‚  â”‚  (1KB)     â”‚  â”‚   (1MB+)   â”‚  â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |ğŸ“Š Nativeå †ç‰¹å¾ï¼š
            |  - ç®¡ç†è€…ï¼šjemallocã€dlmallocç­‰C/C++åˆ†é…å™¨
            |  - æ¥å£ï¼šmalloc(), free(), realloc()
            |  - ä¼˜åŠ¿ï¼šé«˜æ•ˆçš„å†…å­˜å—ç®¡ç†ï¼Œæ”¯æŒä¸åŒå¤§å°åˆ†é…
            |  - Android 8+é‡è¦å˜åŒ–ï¼šå›¾ç‰‡åƒç´ æ•°æ®å­˜å‚¨åœ¨è¿™é‡Œ
        """.trimMargin())
        
        // æ¼”ç¤ºNativeå †çš„åˆ†é…å’Œè§‚å¯Ÿ
        demonstrateNativeHeapAllocation()
    }
    
    private fun demonstrateNativeHeapAllocation() {
        Log.d("ThreeLayer", "ğŸ” ç¬¬äºŒå±‚å®é™…è§‚å¯Ÿï¼šNativeå †åˆ†é…")
        
        val memBefore = getCurrentProcessMemory()
        val nativeBefore = memBefore.nativeHeap
        
        Log.d("ThreeLayer", "Nativeå †åˆ†é…å‰: ${nativeBefore}KB")
        
        // é€šè¿‡Bitmapåˆ†é…Nativeå†…å­˜ï¼ˆAndroid 8+ï¼‰
        val bitmaps = mutableListOf<Bitmap>()
        repeat(8) { index ->
            // æ¯ä¸ªBitmap: 1024Ã—1024Ã—4å­—èŠ‚ = 4MBåƒç´ æ•°æ®
            val bitmap = Bitmap.createBitmap(1024, 1024, Bitmap.Config.ARGB_8888)
            bitmaps.add(bitmap)
            
            // å®æ—¶è§‚å¯Ÿå†…å­˜å˜åŒ–
            if (index % 2 == 1) {
                val currentMem = getCurrentProcessMemory()
                Log.d("ThreeLayer", "åˆ›å»º${index + 1}ä¸ªBitmapåï¼ŒNativeå †: ${currentMem.nativeHeap}KB (+${currentMem.nativeHeap - nativeBefore}KB)")
            }
        }
        
        Thread.sleep(1000)  // ç­‰å¾…å†…å­˜ç»Ÿè®¡æ›´æ–°
        val memAfter = getCurrentProcessMemory()
        val nativeAfter = memAfter.nativeHeap
        
        Log.d("ThreeLayer", """
            |ğŸ“Š Nativeå †åˆ†é…è§‚å¯Ÿç»“æœï¼š
            |  åˆ†é…å‰: ${nativeBefore}KB
            |  åˆ†é…å: ${nativeAfter}KB  
            |  å®é™…å¢é•¿: ${nativeAfter - nativeBefore}KB
            |  ç†è®ºå¢é•¿: ${8 * 4 * 1024}KB (8ä¸ª4MBå›¾ç‰‡)
            |  
            |ğŸ’¡ å…³é”®å‘ç°ï¼š
            |  - å›¾ç‰‡åƒç´ æ•°æ®ç¡®å®åˆ†é…åœ¨Nativeå †ä¸­
            |  - Nativeå †å¯ä»¥åŠ¨æ€å¢é•¿
            |  - è¿™äº›å†…å­˜æœ€ç»ˆæ¥è‡ªç¬¬ä¸€å±‚çš„è¿›ç¨‹å †æ®µ
        """.trimMargin())
        
        // ä¿æŒBitmapå¼•ç”¨ï¼Œé˜²æ­¢è¢«å›æ”¶
        Log.d("ThreeLayer", "åˆ›å»ºçš„Bitmapæ•°é‡: ${bitmaps.size}")
    }
    
    private fun analyzeARTJavaHeapLayer() {
        Log.d("ThreeLayer", """
            |â˜• ç¬¬ä¸‰å±‚ï¼šART Javaå † - "é«˜ç«¯ç‰©ä¸šç®¡ç†å…¬å¸"
            |
            |  åœ¨Nativeå †çš„åŸºç¡€ä¸Šï¼ŒARTè™šæ‹Ÿæœºæ„å»ºçš„Javaå¯¹è±¡ä¸“ç”¨ç®¡ç†å±‚
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                Process Heap Segment                    â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚                  Native Heap                      â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
            |  â”‚  â”‚  â”‚              ART Java Heap                   â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚         (ARTè™šæ‹Ÿæœºä¸“ç”¨ç®¡ç†)                   â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚                                             â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚ EdenåŒº  â”‚ â”‚Survivor â”‚ â”‚    OldåŒº        â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚ (æ–°å¯¹è±¡)â”‚ â”‚  (GC)   â”‚ â”‚  (é•¿æœŸå¯¹è±¡)     â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚          â†‘                                  â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚       Userå¯¹è±¡åœ¨è¿™é‡Œï¼                      â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚                                             â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚   Method Area   â”‚ â”‚   Code Cache        â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚   (ç±»å…ƒæ•°æ®)     â”‚ â”‚  (JITç¼–è¯‘ä»£ç )      â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |ğŸ“Š ART Javaå †ç‰¹å¾ï¼š
            |  - ç®¡ç†è€…ï¼šARTè™šæ‹Ÿæœº (Android Runtime)
            |  - åˆ†é…æ¥å£ï¼šnew æ“ä½œç¬¦, Object.clone() ç­‰
            |  - å›æ”¶æœºåˆ¶ï¼šåˆ†ä»£åƒåœ¾å›æ”¶ (Generational GC)
            |  - å†…å­˜æ¥æºï¼šä»Nativeå †mallocä¸€å¤§å—å†…å­˜ä½œä¸ºåŸºç¡€
        """.trimMargin())
        
        // æ¼”ç¤ºART Javaå †çš„åˆ†é…
        demonstrateARTJavaHeapAllocation()
    }
    
    private fun demonstrateARTJavaHeapAllocation() {
        Log.d("ThreeLayer", "ğŸ” ç¬¬ä¸‰å±‚å®é™…è§‚å¯Ÿï¼šART Javaå †åˆ†é…")
        
        val memBefore = getCurrentProcessMemory()
        val javaBefore = memBefore.dalvikHeap
        val runtimeBefore = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory()
        
        Log.d("ThreeLayer", "ART Javaå †åˆ†é…å‰: ${javaBefore}KB (ç³»ç»Ÿç»Ÿè®¡) | ${runtimeBefore / 1024}KB (Runtimeç»Ÿè®¡)")
        
        // åˆ†é…å¤§é‡Javaå¯¹è±¡
        val users = mutableListOf<User>()
        repeat(5000) { index ->
            users.add(User("Java_$index"))
            
            // æ¯1000ä¸ªå¯¹è±¡è§‚å¯Ÿä¸€æ¬¡
            if ((index + 1) % 1000 == 0) {
                val currentMem = getCurrentProcessMemory()
                val currentRuntime = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory()
                Log.d("ThreeLayer", "åˆ›å»º${index + 1}ä¸ªUseråï¼ŒJavaå †: ${currentMem.dalvikHeap}KB | Runtime: ${currentRuntime / 1024}KB")
            }
        }
        
        Thread.sleep(1000)
        val memAfter = getCurrentProcessMemory()
        val javaAfter = memAfter.dalvikHeap
        val runtimeAfter = Runtime.getRuntime().totalMemory() - Runtime.getRuntime().freeMemory()
        
        Log.d("ThreeLayer", """
            |ğŸ“Š ART Javaå †åˆ†é…è§‚å¯Ÿç»“æœï¼š
            |  ç³»ç»Ÿç»Ÿè®¡ - åˆ†é…å‰: ${javaBefore}KB, åˆ†é…å: ${javaAfter}KB (+${javaAfter - javaBefore}KB)
            |  Runtimeç»Ÿè®¡ - åˆ†é…å‰: ${runtimeBefore / 1024}KB, åˆ†é…å: ${runtimeAfter / 1024}KB (+${(runtimeAfter - runtimeBefore) / 1024}KB)
            |  å¯¹è±¡æ•°é‡: ${users.size}ä¸ªUserå¯¹è±¡
            |  
            |ğŸ’¡ å…³é”®å‘ç°ï¼š
            |  - Javaå¯¹è±¡ç¡®å®åˆ†é…åœ¨ART Javaå †ä¸­
            |  - ART Javaå †çš„å†…å­˜æœ€ç»ˆæ¥è‡ªNativeå †
            |  - å¯ä»¥é€šè¿‡ç³»ç»Ÿå’ŒRuntimeä¸¤ç§æ–¹å¼è§‚å¯Ÿ
        """.trimMargin())
        
        // ä¿æŒUserå¯¹è±¡å¼•ç”¨
        Log.d("ThreeLayer", "åˆ›å»ºçš„Userå¯¹è±¡æ•°é‡: ${users.size}")
    }
    
    private fun verifyNestedRelationship() {
        Log.d("ThreeLayer", """
            |ğŸ¯ ä¸‰å±‚åµŒå¥—å…³ç³»éªŒè¯ï¼š
            |
            |  Userå¯¹è±¡çš„å®Œæ•´å­˜å‚¨è·¯å¾„ï¼š
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚ 1. Userå¯¹è±¡                                           â”‚
            |  â”‚    â”œâ”€ å­˜å‚¨ä½ç½®ï¼šART Javaå † â†’ EdenåŒº                   â”‚
            |  â”‚    â”œâ”€ åˆ†é…æ–¹å¼ï¼šnew User() æ“ä½œ                      â”‚
            |  â”‚    â””â”€ ç®¡ç†è€…ï¼šARTè™šæ‹Ÿæœºçš„åˆ†ä»£GC                       â”‚
            |  â”‚                    â†“ (Javaå †å­˜å‚¨åœ¨Nativeå †ä¸­)          â”‚
            |  â”‚ 2. ART Javaå †                                        â”‚
            |  â”‚    â”œâ”€ å­˜å‚¨ä½ç½®ï¼šNativeå †ä¸­çš„å¤§å—å†…å­˜                   â”‚
            |  â”‚    â”œâ”€ åˆ†é…æ–¹å¼ï¼šARTè™šæ‹Ÿæœºå¯åŠ¨æ—¶mallocç”³è¯·              â”‚
            |  â”‚    â””â”€ ç®¡ç†è€…ï¼šARTè™šæ‹Ÿæœºå†…å­˜ç®¡ç†å™¨                     â”‚
            |  â”‚                    â†“ (Nativeå †ä½¿ç”¨è¿›ç¨‹å †æ®µ)            â”‚
            |  â”‚ 3. Nativeå †                                          â”‚
            |  â”‚    â”œâ”€ å­˜å‚¨ä½ç½®ï¼šè¿›ç¨‹å †æ®µä¸­çš„åŠ¨æ€åˆ†é…åŒºåŸŸ               â”‚
            |  â”‚    â”œâ”€ åˆ†é…æ–¹å¼ï¼šmalloc/freeç³»ç»Ÿè°ƒç”¨                  â”‚
            |  â”‚    â””â”€ ç®¡ç†è€…ï¼šjemallocç­‰C/C++å†…å­˜åˆ†é…å™¨               â”‚
            |  â”‚                    â†“ (ä½¿ç”¨è¿›ç¨‹å †æ®µè™šæ‹Ÿå†…å­˜)            â”‚
            |  â”‚ 4. è¿›ç¨‹å †æ®µ                                          â”‚
            |  â”‚    â”œâ”€ å­˜å‚¨ä½ç½®ï¼šè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ (0x08048000+)        â”‚
            |  â”‚    â”œâ”€ åˆ†é…æ–¹å¼ï¼šbrk()ã€mmap()ç³»ç»Ÿè°ƒç”¨                â”‚
            |  â”‚    â””â”€ ç®¡ç†è€…ï¼šLinuxå†…æ ¸å†…å­˜ç®¡ç†å™¨                    â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |ğŸ”¬ åµŒå¥—å…³ç³»æ€»ç»“ï¼š
            |  è¿›ç¨‹å †æ®µ âŠƒ Nativeå † âŠƒ ART Javaå † âŠƒ Userå¯¹è±¡
            |     â†‘         â†‘          â†‘          â†‘
            |   å†…æ ¸ç®¡ç†   malloc     ARTç®¡ç†    newæ“ä½œ
        """.trimMargin())
        
        // ç”¨å®é™…æ•°æ®éªŒè¯åµŒå¥—å…³ç³»
        val memInfo = getCurrentProcessMemory()
        
        Log.d("ThreeLayer", """
            |ğŸ“Š ä¸‰å±‚å¤§å°å…³ç³»éªŒè¯ï¼š
            |  è¿›ç¨‹æ€»å†…å­˜ (æœ€å¤–å±‚): ${memInfo.totalPss}KB
            |  â””â”€ Nativeå † (ä¸­é—´å±‚): ${memInfo.nativeHeap}KB (å ${memInfo.nativeHeap * 100 / memInfo.totalPss}%)
            |     â””â”€ ART Javaå † (æœ€å†…å±‚): ${memInfo.dalvikHeap}KB (å Nativeå †çš„${if (memInfo.nativeHeap > 0) memInfo.dalvikHeap * 100 / memInfo.nativeHeap else 0}%)
            |
            |âœ… éªŒè¯ç»“æœï¼šç¡®å®æ˜¯ä¸‰å±‚åµŒå¥—çš„å…³ç³»ï¼
        """.trimMargin())
    }
    
    private fun exploreAndroid8Changes() {
        Log.d("ThreeLayer", """
            |ğŸš€ é‡ç‚¹ï¼šAndroid 8çš„æ¶æ„é©å‘½
            |
            |  ä¸ºä»€ä¹ˆå›¾ç‰‡åƒç´ æ•°æ®è¦ä»Javaå †"æ¬å®¶"åˆ°Nativeå †ï¼Ÿ
            |
            |ğŸ“± Android 7åŠä¹‹å‰çš„æƒ…å†µï¼š
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                Process Heap Segment                    â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚                  Native Heap                      â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
            |  â”‚  â”‚  â”‚              ART Java Heap                   â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚ Userå¯¹è±¡â”‚ â”‚å…¶ä»–å¯¹è±¡ â”‚ â”‚ å›¾ç‰‡åƒç´ æ•°æ®!!!  â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚                        â†‘                   â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚               åƒç´ æ•°æ®å ç”¨Javaå †ç©ºé—´         â”‚ â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |âŒ é—®é¢˜ï¼š
            |  1. å›¾ç‰‡åƒç´ æ•°æ®å ç”¨å¤§é‡Javaå †ç©ºé—´
            |  2. å¯¼è‡´é¢‘ç¹çš„GCï¼Œå½±å“æ€§èƒ½
            |  3. é™åˆ¶äº†åº”ç”¨èƒ½åŠ è½½çš„å›¾ç‰‡æ•°é‡
            |
            |ğŸ“± Android 8+çš„æ”¹è¿›ï¼š
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                Process Heap Segment                    â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚                  Native Heap                      â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
            |  â”‚  â”‚  â”‚ å›¾ç‰‡åƒç´ æ•°æ® â”‚  â”‚        ART Java Heap         â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚ (æ¬åˆ°è¿™é‡Œ!) â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚ Userå¯¹è±¡â”‚ â”‚   å…¶ä»–å¯¹è±¡      â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚                   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
            |  â”‚  â”‚                   â”‚     â†‘                        â”‚ â”‚  â”‚
            |  â”‚  â”‚                   â”‚  Javaå †ç©ºé—´é‡Šæ”¾äº†ï¼           â”‚ â”‚  â”‚
            |  â”‚  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |âœ… æ”¹è¿›æ•ˆæœï¼š
            |  1. Javaå †ç©ºé—´å¾—åˆ°é‡Šæ”¾ï¼ŒGCå‹åŠ›å‡å°‘
            |  2. å¯ä»¥åŠ è½½æ›´å¤šå›¾ç‰‡è€Œä¸å½±å“GCæ€§èƒ½
            |  3. å›¾ç‰‡å†…å­˜ç®¡ç†æ›´åŠ çµæ´»
        """.trimMargin())
        
        // éªŒè¯Android 8çš„å˜åŒ–
        verifyAndroid8BitmapMemoryLocation()
    }
    
    private fun verifyAndroid8BitmapMemoryLocation() {
        Log.d("ThreeLayer", "ğŸ” éªŒè¯Android 8+å›¾ç‰‡å†…å­˜åˆ†é…ä½ç½®")
        
        val memBefore = getCurrentProcessMemory()
        
        // åˆ›å»ºå¤§å›¾ç‰‡
        val largeBitmap = Bitmap.createBitmap(2048, 2048, Bitmap.Config.ARGB_8888)
        val pixelDataSize = 2048 * 2048 * 4 / 1024  // ARGBï¼Œæ¯åƒç´ 4å­—èŠ‚ï¼Œè½¬æ¢ä¸ºKB
        
        Thread.sleep(1000)
        val memAfter = getCurrentProcessMemory()
        
        val javaGrowth = memAfter.dalvikHeap - memBefore.dalvikHeap
        val nativeGrowth = memAfter.nativeHeap - memBefore.nativeHeap
        
        Log.d("ThreeLayer", """
            |ğŸ“Š å›¾ç‰‡å†…å­˜åˆ†é…ä½ç½®éªŒè¯ï¼š
            |  å›¾ç‰‡è§„æ ¼: 2048x2048 ARGB
            |  ç†è®ºåƒç´ æ•°æ®å¤§å°: ${pixelDataSize}KB
            |  
            |  å†…å­˜å˜åŒ–ï¼š
            |  Javaå †å¢é•¿: ${javaGrowth}KB
            |  Nativeå †å¢é•¿: ${nativeGrowth}KB
            |  
            |  åˆ†æç»“æœï¼š
            |  ${if (nativeGrowth > javaGrowth * 2) {
                "âœ… å›¾ç‰‡åƒç´ æ•°æ®å­˜å‚¨åœ¨Nativeå †ä¸­ (Android 8+ç‰¹æ€§)"
            } else {
                "â„¹ï¸ å›¾ç‰‡åƒç´ æ•°æ®å¯èƒ½å­˜å‚¨åœ¨Javaå †ä¸­ (Android 7-ç‰¹æ€§æˆ–æµ‹è¯•ç¯å¢ƒ)"
            }}
            |  
            |ğŸ’¡ è¿™è¯å®äº†Android 8æ¶æ„å˜åŒ–çš„é‡è¦æ€§ï¼
        """.trimMargin())
        
        Log.d("ThreeLayer", "æµ‹è¯•å›¾ç‰‡: ${largeBitmap.width}x${largeBitmap.height}")
    }
    
    private fun getCurrentProcessMemory(): Debug.MemoryInfo {
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        return memInfo
    }
}
```

## 2.3 Zygoteè¿›ç¨‹ä¸åº”ç”¨è¿›ç¨‹çš„å†…å­˜å…³ç³» (10åˆ†é’Ÿ)

### ğŸ”¬ Androidç‹¬æœ‰çš„è¿›ç¨‹"å·¥å‚"æœºåˆ¶

```kotlin
class ZygoteProcessAnalysis {
    
    fun exploreZygoteMechanism() {
        Log.d("Zygote", "ğŸ”¬ Androidç‹¬æœ‰æœºåˆ¶ï¼šZygoteè¿›ç¨‹å·¥å‚")
        
        // ç†è§£Zygoteçš„å·¥ä½œåŸç†
        explainZygoteFactory()
        
        // Copy-On-Writeæœºåˆ¶
        demonstrateCopyOnWrite()
        
        // è¿›ç¨‹å†…å­˜å…±äº«ä¸éš”ç¦»
        analyzeMemoryIsolation()
    }
    
    private fun explainZygoteFactory() {
        Log.d("Zygote", """
            |ğŸ­ Zygoteï¼šAndroidçš„è¿›ç¨‹å·¥å‚
            |
            |  ä¸ºä»€ä¹ˆAndroidåº”ç”¨å¯åŠ¨è¿™ä¹ˆå¿«ï¼Ÿç§˜å¯†å°±åœ¨Zygoteæœºåˆ¶ï¼š
            |
            |ğŸ“‹ ä¼ ç»Ÿè¿›ç¨‹åˆ›å»º vs Android Zygoteæ–¹å¼ï¼š
            |
            |  ä¼ ç»Ÿæ–¹å¼ (Linux fork)ï¼š
            |  1. åˆ›å»ºç©ºç™½è¿›ç¨‹ â†’ 2. åŠ è½½è¿è¡Œæ—¶ â†’ 3. åˆå§‹åŒ–è™šæ‹Ÿæœº â†’ 4. åŠ è½½åº”ç”¨ä»£ç 
            |     è€—æ—¶ï¼š~2000ms
            |
            |  Android Zygoteæ–¹å¼ï¼š
            |  1. Zygoteé¢„åŠ è½½å¥½ä¸€åˆ‡ â†’ 2. forkå¤åˆ¶ç°æˆè¿›ç¨‹ â†’ 3. åŠ è½½åº”ç”¨ä»£ç 
            |     è€—æ—¶ï¼š~200ms (10å€æå‡ï¼)
            |
            |ğŸ”¬ Zygoteè¿›ç¨‹çš„å†…å­˜ç»“æ„ï¼š
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                  Zygoteè¿›ç¨‹                            â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚              è¿›ç¨‹å †æ®µ                              â”‚  â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
            |  â”‚  â”‚  â”‚             Nativeå †                         â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚           ART Javaå †                    â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚                                       â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â”‚  é¢„åŠ è½½çš„ç±»  â”‚ â”‚  é¢„åŠ è½½çš„èµ„æº   â”‚ â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â”‚String.class  â”‚ â”‚  ç³»ç»Ÿå­—ä½“       â”‚ â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â”‚Object.class  â”‚ â”‚  ç³»ç»Ÿé¢œè‰²       â”‚ â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â”‚Activity.classâ”‚ â”‚  å›¾æ ‡èµ„æº       â”‚ â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚  â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |                           â†“ fork()
            |                    åˆ›å»ºåº”ç”¨è¿›ç¨‹
        """.trimMargin())
        
        // æ¨¡æ‹ŸZygoteé¢„åŠ è½½è¿‡ç¨‹
        simulateZygotePreload()
    }
    
    private fun simulateZygotePreload() {
        Log.d("Zygote", """
            |ğŸ¯ æ¨¡æ‹ŸZygoteé¢„åŠ è½½è¿‡ç¨‹ï¼š
            |
            |  Zygoteå¯åŠ¨æ—¶é¢„åŠ è½½çš„å†…å®¹ï¼š
            |  1. ç³»ç»Ÿç±»åº“ (çº¦4000ä¸ªç±»)
            |  2. ç³»ç»Ÿèµ„æº (å­—ä½“ã€é¢œè‰²ã€å›¾æ ‡ç­‰)
            |  3. JNIå‡½æ•°æ³¨å†Œ
            |  4. ARTè™šæ‹Ÿæœºä¼˜åŒ–
            |
            |ğŸ’» ç›¸å…³æºç ä½ç½®ï¼š
            |  - ZygoteInit.java: Zygoteä¸»å…¥å£
            |  - ZygoteServer.java: å¤„ç†forkè¯·æ±‚
            |  - Zygote.cpp: Nativeå±‚forkå®ç°
        """.trimMargin())
        
        // è·å–å½“å‰è¿›ç¨‹ä¿¡æ¯ï¼Œæ¨¡æ‹Ÿè§‚å¯Ÿ
        val processId = android.os.Process.myPid()
        val packageName = "com.yourapp"  // æ›¿æ¢ä¸ºå®é™…åŒ…å
        
        Log.d("Zygote", """
            |ğŸ” å½“å‰åº”ç”¨è¿›ç¨‹ä¿¡æ¯ï¼š
            |  è¿›ç¨‹ID: $processId
            |  åŒ…å: $packageName
            |  çˆ¶è¿›ç¨‹: Zygote (å¯é€šè¿‡ ps å‘½ä»¤æŸ¥çœ‹)
            |  
            |ğŸ’» éªŒè¯å‘½ä»¤ï¼š
            |  adb shell ps | grep $packageName
            |  adb shell cat /proc/$processId/status | grep PPid
        """.trimMargin())
    }
    
    private fun demonstrateCopyOnWrite() {
        Log.d("Zygote", """
            |ğŸ“‹ Copy-On-Write (COW) æœºåˆ¶è¯¦è§£ï¼š
            |
            |  è¿™æ˜¯Zygoteé«˜æ•ˆçš„æ ¸å¿ƒæœºåˆ¶ï¼Œå°±åƒ"å…±äº«å›¾ä¹¦é¦†"ï¼š
            |
            |ğŸ”¬ COWå·¥ä½œåŸç†ï¼š
            |
            |  é˜¶æ®µ1ï¼šZygote forkåº”ç”¨è¿›ç¨‹
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚   Zygoteè¿›ç¨‹    â”‚    â”‚   åº”ç”¨è¿›ç¨‹A     â”‚
            |  â”‚                â”‚    â”‚                â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚  å…±äº«å†…å­˜  â”‚â†â”€â”¼â”€â”€â”€â”€â”¼â†’â”‚  å…±äº«å†…å­˜  â”‚  â”‚
            |  â”‚  â”‚ (åªè¯»è®¿é—®) â”‚  â”‚    â”‚  â”‚ (åªè¯»è®¿é—®) â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |         â†‘                        â†‘
            |    å®é™…ä¸ŠæŒ‡å‘åŒä¸€å—ç‰©ç†å†…å­˜ (èŠ‚çº¦å†…å­˜!)
            |
            |  é˜¶æ®µ2ï¼šåº”ç”¨è¿›ç¨‹ä¿®æ”¹æ•°æ®æ—¶
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚   Zygoteè¿›ç¨‹    â”‚    â”‚   åº”ç”¨è¿›ç¨‹A     â”‚
            |  â”‚                â”‚    â”‚                â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |  â”‚  â”‚ åŸå§‹å†…å­˜   â”‚  â”‚    â”‚  â”‚ ç§æœ‰å‰¯æœ¬   â”‚  â”‚
            |  â”‚  â”‚ (ä¸å˜)     â”‚  â”‚    â”‚  â”‚ (ä¿®æ”¹å)   â”‚  â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |                               â†‘
            |                        åªæœ‰ä¿®æ”¹æ—¶æ‰å¤åˆ¶
        """.trimMargin())
        
        // æ¼”ç¤ºCOWæ•ˆæœçš„è§‚å¯Ÿæ–¹æ³•
        demonstrateCOWEffect()
    }
    
    private fun demonstrateCOWEffect() {
        Log.d("Zygote", "ğŸ” è§‚å¯ŸCopy-On-Writeæ•ˆæœ")
        
        val processId = android.os.Process.myPid()
        
        // è¯»å–è¿›ç¨‹å†…å­˜ä¿¡æ¯
        val memInfo = getCurrentProcessMemory()
        
        Log.d("Zygote", """
            |ğŸ“Š å½“å‰è¿›ç¨‹å†…å­˜çŠ¶æ€ï¼š
            |  æ€»å†…å­˜(PSS): ${memInfo.totalPss}KB
            |  ç§æœ‰è„é¡µ: ${memInfo.totalPrivateDirty}KB  â† COWåçš„ç§æœ‰å‰¯æœ¬
            |  ç§æœ‰å¹²å‡€é¡µ: ${memInfo.totalPrivateClean}KB â† æœªä¿®æ”¹çš„ç§æœ‰é¡µé¢
            |  å…±äº«è„é¡µ: ${memInfo.totalSharedDirty}KB   â† ä¸å…¶ä»–è¿›ç¨‹å…±äº«çš„ä¿®æ”¹é¡µé¢
            |  å…±äº«å¹²å‡€é¡µ: ${memInfo.totalSharedClean}KB â† ä¸Zygoteç­‰å…±äº«çš„åŸå§‹é¡µé¢
            |
            |ğŸ’¡ COWæ•ˆç‡åˆ†æï¼š
            |  å…±äº«å†…å­˜å æ¯”: ${(memInfo.totalSharedClean + memInfo.totalSharedDirty) * 100 / memInfo.totalPss}%
            |  ç§æœ‰å†…å­˜å æ¯”: ${(memInfo.totalPrivateClean + memInfo.totalPrivateDirty) * 100 / memInfo.totalPss}%
            |  
            |ğŸ’» è¯¦ç»†æŸ¥çœ‹å‘½ä»¤ï¼š
            |  adb shell cat /proc/$processId/smaps | grep -A 1 "Shared"
        """.trimMargin())
        
        // åˆ›å»ºä¸€äº›å¯¹è±¡æ¥è§‚å¯ŸCOWæ•ˆæœ
        createObjectsToObserveCOW()
    }
    
    private fun createObjectsToObserveCOW() {
        Log.d("Zygote", "ğŸ¯ åˆ›å»ºå¯¹è±¡è§‚å¯ŸCOWæ•ˆæœ")
        
        val beforeMem = getCurrentProcessMemory()
        
        // åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œè¿™ä¼šå¯¼è‡´COW
        val appSpecificObjects = Array(2000) { User("COW_$it") }
        
        Thread.sleep(1000)
        val afterMem = getCurrentProcessMemory()
        
        val privateDirtyGrowth = afterMem.totalPrivateDirty - beforeMem.totalPrivateDirty
        
        Log.d("Zygote", """
            |ğŸ“Š COWæ•ˆæœè§‚å¯Ÿï¼š
            |  åˆ›å»ºå¯¹è±¡å‰ç§æœ‰è„é¡µ: ${beforeMem.totalPrivateDirty}KB
            |  åˆ›å»ºå¯¹è±¡åç§æœ‰è„é¡µ: ${afterMem.totalPrivateDirty}KB
            |  å¢é•¿: ${privateDirtyGrowth}KB â† è¿™å°±æ˜¯COWäº§ç”Ÿçš„ç§æœ‰å‰¯æœ¬
            |  
            |ğŸ’¡ åˆ†æï¼š
            |  - åˆ›å»ºåº”ç”¨ç‰¹å®šå¯¹è±¡è§¦å‘äº†COW
            |  - åŸæœ¬å…±äº«çš„å†…å­˜é¡µå˜æˆäº†ç§æœ‰å‰¯æœ¬
            |  - è¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œè¯´æ˜åº”ç”¨åœ¨ç‹¬ç«‹è¿è¡Œ
        """.trimMargin())
        
        Log.d("Zygote", "åˆ›å»ºå¯¹è±¡æ•°é‡: ${appSpecificObjects.size}")
    }
    
    private fun analyzeMemoryIsolation() {
        Log.d("Zygote", """
            |ğŸ”’ è¿›ç¨‹å†…å­˜éš”ç¦»ä¸å…±äº«çš„å¹³è¡¡ï¼š
            |
            |ğŸ¯ Androidå†…å­˜ç®¡ç†çš„æ™ºæ…§ï¼š
            |
            |  éš”ç¦»æ–¹é¢ï¼š
            |  â”œâ”€ æ¯ä¸ªåº”ç”¨æœ‰ç‹¬ç«‹çš„è¿›ç¨‹ç©ºé—´
            |  â”œâ”€ è™šæ‹Ÿåœ°å€ç©ºé—´å®Œå…¨éš”ç¦» 
            |  â”œâ”€ åº”ç”¨æ•°æ®ä¸èƒ½äº’ç›¸è®¿é—®
            |  â””â”€ è¿›ç¨‹å´©æºƒä¸å½±å“å…¶ä»–åº”ç”¨
            |
            |  å…±äº«æ–¹é¢ï¼š
            |  â”œâ”€ ç³»ç»Ÿç±»åº“ä»£ç å…±äº« (String.classç­‰)
            |  â”œâ”€ ç³»ç»Ÿèµ„æºå…±äº« (å­—ä½“ã€å›¾æ ‡ç­‰)
            |  â”œâ”€ Frameworkä»£ç å…±äº« (.soæ–‡ä»¶)
            |  â””â”€ é€šè¿‡COWæœºåˆ¶ä¼˜é›…å®ç°
            |
            |ğŸ—ï¸ è¿™ç§è®¾è®¡çš„ä¼˜åŠ¿ï¼š
            |  1. å®‰å…¨æ€§ï¼šåº”ç”¨é—´å®Œå…¨éš”ç¦»
            |  2. ç¨³å®šæ€§ï¼šå•ä¸ªåº”ç”¨å´©æºƒä¸å½±å“ç³»ç»Ÿ
            |  3. æ•ˆç‡ï¼šé€šè¿‡å…±äº«å‡å°‘å†…å­˜ä½¿ç”¨
            |  4. å¿«é€Ÿï¼šé€šè¿‡ZygoteåŠ é€Ÿåº”ç”¨å¯åŠ¨
            |
            |ğŸ“Š å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼š
            |  - å¦‚æœæ²¡æœ‰COWï¼šæ¯ä¸ªåº”ç”¨éƒ½è¦å®Œæ•´å¤åˆ¶ç³»ç»Ÿç±»åº“
            |  - 10ä¸ªåº”ç”¨ Ã— 50MBç³»ç»Ÿåº“ = 500MBæµªè´¹
            |  - æœ‰äº†COWï¼š10ä¸ªåº”ç”¨å…±äº«50MBï¼ŒèŠ‚çœ450MBï¼
        """.trimMargin())
    }
    
    private fun getCurrentProcessMemory(): Debug.MemoryInfo {
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        return memInfo
    }
}
```

## 2.4 Androidç‰¹æœ‰çš„å†…å­˜ç®¡ç†ç‰¹æ€§ (10åˆ†é’Ÿ)

### ğŸ”¬ æ·±å…¥Androidç‹¬ç‰¹çš„å†…å­˜ç®¡ç†æœºåˆ¶

```kotlin
class AndroidSpecificMemoryFeatures {
    
    fun exploreAndroidMemoryFeatures() {
        Log.d("AndroidFeatures", "ğŸ”¬ Androidç‰¹æœ‰çš„å†…å­˜ç®¡ç†ç‰¹æ€§")
        
        // ç‰¹æ€§1ï¼šLow Memory Killer
        analyzeLowMemoryKiller()
        
        // ç‰¹æ€§2ï¼šè¿›ç¨‹ä¼˜å…ˆçº§ä¸å†…å­˜å›æ”¶
        analyzeProcessPriority()
        
        // ç‰¹æ€§3ï¼šçº¿ç¨‹æ ˆçš„ç‰¹æ®Šå¤„ç†
        analyzeThreadStackManagement()
        
        // ç‰¹æ€§4ï¼šAshmem (Anonymous Shared Memory)
        analyzeAshmemMechanism()
    }
    
    private fun analyzeLowMemoryKiller() {
        Log.d("AndroidFeatures", """
            |âš¡ ç‰¹æ€§1ï¼šLow Memory Killer (LMK) - Androidçš„å†…å­˜å®ˆæŠ¤è€…
            |
            |  å½“ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ï¼ŒAndroidä¸ä¼šåƒæ¡Œé¢Linuxé‚£æ ·ä½¿ç”¨Swapï¼Œ
            |  è€Œæ˜¯ä½¿ç”¨LMKæœºåˆ¶æ™ºèƒ½æ€æ‰è¿›ç¨‹ï¼š
            |
            |ğŸ“Š LMKçš„è¿›ç¨‹ä¼˜å…ˆçº§åˆ†ç±»ï¼š
            |
            |  ä¼˜å…ˆçº§ç­‰çº§    OOM_ADJå€¼    æè¿°                    è¢«æ€æ¦‚ç‡
            |  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€
            |  å‰å°è¿›ç¨‹        0         ç”¨æˆ·æ­£åœ¨äº¤äº’çš„è¿›ç¨‹      æœ€ä½
            |  å¯è§è¿›ç¨‹        100       ç”¨æˆ·å¯è§ä½†éå‰å°        ä½
            |  æœåŠ¡è¿›ç¨‹        300       åå°æœåŠ¡è¿›ç¨‹            ä¸­ç­‰
            |  åå°è¿›ç¨‹        400       ç”¨æˆ·æœ€è¿‘ä½¿ç”¨è¿‡çš„åº”ç”¨     è¾ƒé«˜  
            |  ç©ºè¿›ç¨‹          900       æ²¡æœ‰ä»»ä½•ç»„ä»¶çš„è¿›ç¨‹       æœ€é«˜
            |
            |ğŸ¯ LMKè§¦å‘æ¡ä»¶ (å†…å­˜é˜ˆå€¼)ï¼š
            |  - å¯ç”¨å†…å­˜ < 200MB â†’ æ€æ‰ç©ºè¿›ç¨‹
            |  - å¯ç”¨å†…å­˜ < 150MB â†’ æ€æ‰åå°è¿›ç¨‹
            |  - å¯ç”¨å†…å­˜ < 100MB â†’ æ€æ‰æœåŠ¡è¿›ç¨‹
            |  - å¯ç”¨å†…å­˜ < 50MB  â†’ æ€æ‰å¯è§è¿›ç¨‹
            |
            |ğŸ’¡ åº”ç”¨å¼€å‘å¯ç¤ºï¼š
            |  1. åŠæ—¶é‡Šæ”¾ä¸å¿…è¦çš„å†…å­˜
            |  2. åˆç†ä½¿ç”¨åå°æœåŠ¡
            |  3. å“åº”onTrimMemory()å›è°ƒ
        """.trimMargin())
        
        // è·å–å½“å‰è¿›ç¨‹çš„OOMè°ƒæ•´å€¼
        getCurrentProcessOOMInfo()
    }
    
    private fun getCurrentProcessOOMInfo() {
        val processId = android.os.Process.myPid()
        val activityManager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
        
        // è·å–ç³»ç»Ÿå†…å­˜ä¿¡æ¯
        val memoryInfo = ActivityManager.MemoryInfo()
        activityManager.getMemoryInfo(memoryInfo)
        
        Log.d("AndroidFeatures", """
            |ğŸ” å½“å‰è¿›ç¨‹OOMä¿¡æ¯ï¼š
            |  è¿›ç¨‹ID: $processId
            |  ç³»ç»Ÿæ€»å†…å­˜: ${memoryInfo.totalMem / 1024 / 1024}MB
            |  å¯ç”¨å†…å­˜: ${memoryInfo.availMem / 1024 / 1024}MB
            |  ä½å†…å­˜é˜ˆå€¼: ${memoryInfo.threshold / 1024 / 1024}MB
            |  å†…å­˜ç´§å¼ : ${if (memoryInfo.lowMemory) "æ˜¯" else "å¦"}
            |
            |ğŸ’» æŸ¥çœ‹è¯¦ç»†OOMä¿¡æ¯å‘½ä»¤ï¼š
            |  adb shell cat /proc/$processId/oom_score_adj  # å½“å‰OOMè°ƒæ•´å€¼
            |  adb shell cat /proc/meminfo                   # ç³»ç»Ÿå†…å­˜è¯¦æƒ…
        """.trimMargin())
        
        // æ¨¡æ‹Ÿå†…å­˜å‹åŠ›æµ‹è¯•
        simulateMemoryPressure()
    }
    
    private fun simulateMemoryPressure() {
        Log.d("AndroidFeatures", "ğŸ¯ æ¨¡æ‹Ÿå†…å­˜å‹åŠ›ï¼Œè§‚å¯Ÿç³»ç»Ÿå“åº”")
        
        val memInfo = getCurrentProcessMemory()
        val beforeMemory = memInfo.totalPss
        
        // åˆ›å»ºå¤§é‡å¯¹è±¡å¢åŠ å†…å­˜å‹åŠ›
        val pressureObjects = mutableListOf<ByteArray>()
        
        try {
            repeat(100) { index ->
                // æ¯æ¬¡åˆ†é…5MB
                val largeArray = ByteArray(5 * 1024 * 1024) { it.toByte() }
                pressureObjects.add(largeArray)
                
                if (index % 10 == 0) {
                    val currentMem = getCurrentProcessMemory()
                    Log.d("AndroidFeatures", "å†…å­˜å‹åŠ›æµ‹è¯• ${index}/100: å½“å‰ä½¿ç”¨${currentMem.totalPss}KB (+${currentMem.totalPss - beforeMemory}KB)")
                }
                
                // æ£€æŸ¥ç³»ç»Ÿå†…å­˜çŠ¶æ€
                if (index % 20 == 0) {
                    val activityManager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
                    val memoryInfo = ActivityManager.MemoryInfo()
                    activityManager.getMemoryInfo(memoryInfo)
                    
                    if (memoryInfo.lowMemory) {
                        Log.w("AndroidFeatures", "âš ï¸ ç³»ç»Ÿå†…å­˜ç´§å¼ ï¼ŒLMKå¯èƒ½æ¿€æ´»ï¼")
                        break
                    }
                }
            }
        } catch (e: OutOfMemoryError) {
            Log.e("AndroidFeatures", "ğŸ’¥ è§¦å‘OOMå¼‚å¸¸: ${e.message}")
        }
        
        Log.d("AndroidFeatures", "å†…å­˜å‹åŠ›æµ‹è¯•å®Œæˆï¼Œåˆ†é…äº†${pressureObjects.size}ä¸ª5MBæ•°ç»„")
    }
    
    private fun analyzeProcessPriority() {
        Log.d("AndroidFeatures", """
            |ğŸ¯ ç‰¹æ€§2ï¼šè¿›ç¨‹ä¼˜å…ˆçº§åŠ¨æ€è°ƒæ•´
            |
            |  Androidä¼šæ ¹æ®åº”ç”¨çš„çŠ¶æ€åŠ¨æ€è°ƒæ•´è¿›ç¨‹ä¼˜å…ˆçº§ï¼š
            |
            |ğŸ“‹ ä¼˜å…ˆçº§å˜åŒ–åœºæ™¯ï¼š
            |
            |  åº”ç”¨çŠ¶æ€å˜åŒ–          ä¼˜å…ˆçº§å˜åŒ–         OOM_ADJå˜åŒ–
            |  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            |  å¯åŠ¨Activity     â†’  æå‡ä¸ºå‰å°è¿›ç¨‹    â†’  0
            |  æŒ‰Homeé”®è¿”å›     â†’  é™ä¸ºåå°è¿›ç¨‹      â†’  400  
            |  å¯åŠ¨Service      â†’  æå‡ä¸ºæœåŠ¡è¿›ç¨‹    â†’  300
            |  ç»‘å®šå¯è§Activity â†’  æå‡ä¸ºå¯è§è¿›ç¨‹    â†’  100
            |  é•¿æ—¶é—´æœªä½¿ç”¨      â†’  é™ä¸ºç©ºè¿›ç¨‹        â†’  900
            |
            |ğŸ”¬ ä¼˜å…ˆçº§å¯¹å†…å­˜ç®¡ç†çš„å½±å“ï¼š
            |  1. é«˜ä¼˜å…ˆçº§è¿›ç¨‹ä¸å®¹æ˜“è¢«LMKæ€æ‰
            |  2. ä½ä¼˜å…ˆçº§è¿›ç¨‹ä¼˜å…ˆé‡Šæ”¾å†…å­˜
            |  3. ç³»ç»ŸåŠ¨æ€å¹³è¡¡å†…å­˜ä½¿ç”¨
            |
            |ğŸ’» ç›‘æ§å‘½ä»¤ï¼š
            |  adb shell dumpsys activity processes  # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹ä¼˜å…ˆçº§
        """.trimMargin())
    }
    
    private fun analyzeThreadStackManagement() {
        Log.d("AndroidFeatures", """
            |ğŸ§µ ç‰¹æ€§3ï¼šAndroidçº¿ç¨‹æ ˆçš„ç‰¹æ®Šç®¡ç†
            |
            |  Androidå¯¹çº¿ç¨‹æ ˆçš„ç®¡ç†æœ‰ç‹¬ç‰¹ä¹‹å¤„ï¼š
            |
            |ğŸ”¬ ä¸»çº¿ç¨‹ vs æ™®é€šçº¿ç¨‹çš„æ ˆç®¡ç†å·®å¼‚ï¼š
            |
            |  ä¸»çº¿ç¨‹æ ˆï¼š
            |  â”œâ”€ ä½¿ç”¨è¿›ç¨‹çš„åŸå§‹æ ˆç©ºé—´
            |  â”œâ”€ æ ˆå¤§å°ï¼šé€šå¸¸8MB (å¯é€šè¿‡ulimitæŸ¥çœ‹)
            |  â”œâ”€ ä½ç½®ï¼šè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ ˆæ®µ
            |  â””â”€ ç‰¹ç‚¹ï¼šç”±ç³»ç»Ÿåˆ›å»ºè¿›ç¨‹æ—¶åˆ†é…
            |
            |  æ™®é€šçº¿ç¨‹æ ˆï¼š
            |  â”œâ”€ ç‹¬ç«‹åˆ†é…æ ˆç©ºé—´ (é€šè¿‡mmap)
            |  â”œâ”€ æ ˆå¤§å°ï¼šé»˜è®¤1MB (å¯é€šè¿‡pthread_attr_setstacksizeè°ƒæ•´)
            |  â”œâ”€ ä½ç½®ï¼šå†…å­˜æ˜ å°„åŒºåŸŸ
            |  â””â”€ ç‰¹ç‚¹ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹çš„æ ˆç©ºé—´
        """.trimMargin())
        
        // æ¼”ç¤ºçº¿ç¨‹æ ˆå·®å¼‚
        demonstrateThreadStackDifference()
    }
    
    private fun demonstrateThreadStackDifference() {
        Log.d("AndroidFeatures", "ğŸ” æ¼”ç¤ºä¸»çº¿ç¨‹vsæ™®é€šçº¿ç¨‹çš„æ ˆå·®å¼‚")
        
        val processId = android.os.Process.myPid()
        val mainThreadId = android.os.Process.myTid()
        
        Log.d("AndroidFeatures", """
            |ğŸ“Š çº¿ç¨‹ä¿¡æ¯ï¼š
            |  è¿›ç¨‹ID: $processId
            |  ä¸»çº¿ç¨‹ID: $mainThreadId
        """.trimMargin())
        
        // åœ¨ä¸»çº¿ç¨‹ä¸­åˆ†é…æ ˆæ•°æ®
        fun mainThreadStackTest() {
            val mainStackArray = IntArray(10000) { it }  // ä¸»çº¿ç¨‹æ ˆåˆ†é…
            Log.d("AndroidFeatures", "ä¸»çº¿ç¨‹æ ˆæµ‹è¯•ï¼Œæ•°ç»„å¤§å°: ${mainStackArray.size}")
        }
        mainThreadStackTest()
        
        // åˆ›å»ºæ™®é€šçº¿ç¨‹æµ‹è¯•
        val thread = Thread {
            val threadStackArray = IntArray(10000) { it }  // æ™®é€šçº¿ç¨‹æ ˆåˆ†é…
            Log.d("AndroidFeatures", "æ™®é€šçº¿ç¨‹æ ˆæµ‹è¯•ï¼Œçº¿ç¨‹ID: ${Thread.currentThread().id}, æ•°ç»„å¤§å°: ${threadStackArray.size}")
        }
        thread.start()
        thread.join()
        
        Log.d("AndroidFeatures", """
            |ğŸ’» æŸ¥çœ‹çº¿ç¨‹æ ˆä¿¡æ¯ï¼š
            |  adb shell cat /proc/$processId/maps | grep stack
            |  adb shell cat /proc/$processId/task/*/maps | grep stack
        """.trimMargin())
    }
    
    private fun analyzeAshmemMechanism() {
        Log.d("AndroidFeatures", """
            |ğŸ”„ ç‰¹æ€§4ï¼šAshmem (Anonymous Shared Memory) - Androidçš„è¿›ç¨‹é—´å†…å­˜å…±äº«
            |
            |  Ashmemæ˜¯Androidç‰¹æœ‰çš„åŒ¿åå…±äº«å†…å­˜æœºåˆ¶ï¼š
            |
            |ğŸ¯ Ashmemçš„ç‰¹ç‚¹ï¼š
            |  1. è¿›ç¨‹é—´å…±äº«ï¼šå¤šä¸ªè¿›ç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å†…å­˜
            |  2. åŒ¿åå†…å­˜ï¼šä¸å¯¹åº”æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶
            |  3. å¯å›æ”¶ï¼šç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶å¯ä»¥è¢«å›æ”¶
            |  4. å¼•ç”¨è®¡æ•°ï¼šè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ
            |
            |ğŸ”¬ Ashmemçš„åº”ç”¨åœºæ™¯ï¼š
            |  â”œâ”€ Binderé€šä¿¡çš„å¤§æ•°æ®ä¼ è¾“
            |  â”œâ”€ SurfaceFlingerçš„å›¾å½¢ç¼“å†²åŒº
            |  â”œâ”€ å¤šåª’ä½“æ¡†æ¶çš„ç¼“å†²åŒºå…±äº«
            |  â””â”€ è·¨è¿›ç¨‹çš„Bitmapå…±äº«
            |
            |ğŸ“Š Ashmem vs ä¼ ç»Ÿå…±äº«å†…å­˜ï¼š
            |
            |  ç‰¹æ€§              ä¼ ç»Ÿå…±äº«å†…å­˜     Ashmem
            |  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
            |  åˆ›å»ºæ–¹å¼          shmget()       ashmem_create_region()
            |  å›æ”¶èƒ½åŠ›          ä¸å¯å›æ”¶        å¯å›æ”¶
            |  æƒé™ç®¡ç†          System V IPC   æ–‡ä»¶æè¿°ç¬¦
            |  Androidé›†æˆ      éœ€è¦é€‚é…        åŸç”Ÿæ”¯æŒ
            |
            |ğŸ’» ç›¸å…³å‘½ä»¤ï¼š
            |  adb shell cat /proc/meminfo | grep Shmem  # æŸ¥çœ‹å…±äº«å†…å­˜ä½¿ç”¨
        """.trimMargin())
    }
    
    private fun getCurrentProcessMemory(): Debug.MemoryInfo {
        val memInfo = Debug.MemoryInfo()
        Debug.getMemoryInfo(memInfo)
        return memInfo
    }
}
```

---

# ğŸ”„ å±‚çº§è½¬æ¢ï¼šä»è™šæ‹Ÿåˆ°ç‰©ç† (5åˆ†é’Ÿ)

## ğŸ”¬ æ˜¾å¾®é•œæœ€ç»ˆè°ƒæ•´ï¼šä»400xåˆ°4000x

### ä»è¿›ç¨‹ç©ºé—´åˆ°ç¡¬ä»¶ä¸–ç•Œçš„æœ€åè½¬æ¢

```kotlin
class FinalVirtualToPhysicalTransition {
    
    fun transitionToHardwareLevel() {
        Log.d("FinalTransition", "ğŸ”¬ æ˜¾å¾®é•œæœ€ç»ˆè°ƒæ•´ï¼š400x â†’ 4000x")
        
        Log.d("FinalTransition", """
            |ğŸ¯ ç»ˆæè½¬æ¢ï¼šä»è½¯ä»¶æŠ½è±¡åˆ°ç¡¬ä»¶ç°å®
            |
            |400xè§†è§’æ€»ç»“ï¼ˆè¿›ç¨‹ç©ºé—´å±‚é¢ï¼‰ï¼š
            |  âœ… å·²ç†è§£ï¼šè¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„å®Œæ•´å¸ƒå±€
            |  âœ… å·²æŒæ¡ï¼šä¸‰å±‚å †çš„åµŒå¥—å…³ç³» (è¿›ç¨‹å †æ®µâŠƒNativeå †âŠƒARTå †)
            |  âœ… å·²è®¤è¯†ï¼šZygoteæœºåˆ¶å’ŒCOWä¼˜åŒ–
            |  âœ… å·²äº†è§£ï¼šAndroidç‰¹æœ‰çš„å†…å­˜ç®¡ç†ç‰¹æ€§
            |  
            |ğŸš€ æœ€ç»ˆé—®é¢˜ï¼šè¿™äº›è™šæ‹Ÿåœ°å€èƒŒåçš„ç¡¬ä»¶ç°å®æ˜¯ä»€ä¹ˆï¼Ÿ
            |
            |4000xè§†è§’é¢„å‘Šï¼ˆç¡¬ä»¶å±‚é¢ï¼‰ï¼š
            |  ğŸ” Userå¯¹è±¡çš„è™šæ‹Ÿåœ°å€å¦‚ä½•æ˜ å°„åˆ°ç‰©ç†RAMï¼Ÿ
            |  ğŸ” ä¸ºä»€ä¹ˆæœ‰æ—¶è®¿é—®å†…å­˜å¾ˆå¿«ï¼Œæœ‰æ—¶å¾ˆæ…¢ï¼Ÿ
            |  ğŸ” CPUç¼“å­˜å±‚æ¬¡å¦‚ä½•å½±å“Androidæ€§èƒ½ï¼Ÿ
            |  ğŸ” å¦‚ä½•åŸºäºç¡¬ä»¶ç‰¹æ€§ä¼˜åŒ–Androidåº”ç”¨ï¼Ÿ
        """.trimMargin())
        
        demonstrateVirtualToPhysicalMapping()
    }
    
    private fun demonstrateVirtualToPhysicalMapping() {
        Log.d("FinalTransition", """
            |ğŸ—ºï¸ è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢ç¤ºä¾‹ï¼š
            |
            |  ä½ çš„Userå¯¹è±¡çš„å®Œæ•´åœ°å€è½¬æ¢è·¯å¾„ï¼š
            |  
            |  1ï¸âƒ£ Javaå±‚é¢ï¼š
            |     Userå¯¹è±¡å¼•ç”¨ â†’ ARTè™šæ‹Ÿæœºå†…éƒ¨åœ°å€
            |  
            |  2ï¸âƒ£ è¿›ç¨‹è™šæ‹Ÿåœ°å€ï¼š
            |     ARTå†…éƒ¨åœ°å€ â†’ è¿›ç¨‹è™šæ‹Ÿåœ°å€ (ä¾‹å¦‚: 0x12345678)
            |  
            |  3ï¸âƒ£ ç‰©ç†åœ°å€è½¬æ¢ï¼š
            |     è™šæ‹Ÿåœ°å€ â†’ MMUè½¬æ¢ â†’ ç‰©ç†åœ°å€ (ä¾‹å¦‚: 0x87654321)
            |  
            |  4ï¸âƒ£ ç¡¬ä»¶å±‚é¢ï¼š
            |     ç‰©ç†åœ°å€ â†’ RAMèŠ¯ç‰‡ â†’ å­˜å‚¨å•å…ƒ â†’ å®é™…çš„ç”µå­çŠ¶æ€
            |
            |ğŸ”¬ æ¥ä¸‹æ¥20åˆ†é’Ÿæˆ‘ä»¬å°†çœ‹åˆ°ï¼š
            |  - è¿™ä¸ªç‰©ç†åœ°å€å¯¹åº”RAMçš„å“ªä¸ªèŠ¯ç‰‡
            |  - CPUå¦‚ä½•é€šè¿‡ç¼“å­˜å±‚æ¬¡è®¿é—®æ•°æ®  
            |  - å†…å­˜æ§åˆ¶å™¨å¦‚ä½•ç®¡ç†æ•°æ®æµ
            |  - å¦‚ä½•åŸºäºè¿™äº›çŸ¥è¯†ä¼˜åŒ–Androidæ€§èƒ½
        """.trimMargin())
    }
}
```

---

# âš¡ ç¬¬ä¸‰å±‚ï¼šç¡¬ä»¶æ¶æ„ä¸ä¼˜åŒ– (4000xæ”¾å¤§) (20åˆ†é’Ÿ)

## 3.1 ç‰©ç†å†…å­˜ç¡¬ä»¶æ¶æ„ (12åˆ†é’Ÿ)

### ğŸ”¬ 4000xæ˜¾å¾®é•œï¼šæ·±å…¥ç¡¬ä»¶ä¸–ç•Œ

```kotlin
class PhysicalMemoryHardware {
    
    fun exploreHardwareArchitecture() {
        Log.d("Hardware", "ğŸ”¬ 4000xè§†è§’ï¼šç‰©ç†å†…å­˜ç¡¬ä»¶æ¶æ„")
        
        // ç¡¬ä»¶ç»„æˆåˆ†æ
        analyzeHardwareComponents()
        
        // ç¼“å­˜å±‚æ¬¡ç»“æ„
        analyzeCacheHierarchy()
        
        // å†…å­˜è®¿é—®æ€§èƒ½æµ‹é‡
        measureMemoryPerformance()
    }
    
    private fun analyzeHardwareComponents() {
        Log.d("Hardware", """
            |ğŸ”¬ Userå¯¹è±¡çš„ç¡¬ä»¶å­˜å‚¨æ¶æ„ï¼š
            |
            |  å½“æˆ‘ä»¬æ·±å…¥åˆ°4000xæ˜¾å¾®é•œçº§åˆ«ï¼Œçœ‹åˆ°çš„æ˜¯ï¼š
            |
            |ğŸ“± ç§»åŠ¨è®¾å¤‡å†…å­˜ç¡¬ä»¶æ¶æ„ï¼š
            |  
            |                    [CPU Core]
            |                         â†‘
            |    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |    â”‚                    â†“                     â”‚
            |    â”‚              [Memory Controller]         â”‚
            |    â”‚                     â”‚                     â”‚
            |    â”‚                     â†“                     â”‚
            |    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
            |    â”‚  â”‚            DRAM èŠ¯ç‰‡                â”‚  â”‚
            |    â”‚  â”‚                                    â”‚  â”‚
            |    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”  â”‚  â”‚
            |    â”‚  â”‚  â”‚Bank0â”‚ â”‚Bank1â”‚ â”‚Bank2â”‚ â”‚Bank3â”‚  â”‚  â”‚ â† Userå¯¹è±¡æ•°æ®
            |    â”‚  â”‚  â”‚     â”‚ â”‚     â”‚ â”‚     â”‚ â”‚     â”‚  â”‚  â”‚   å­˜å‚¨åœ¨æŸä¸ªBankä¸­
            |    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
            |    â”‚  â”‚                                    â”‚  â”‚
            |    â”‚  â”‚  æ¯ä¸ªBankåŒ…å«æ•°ç™¾ä¸‡ä¸ªå­˜å‚¨å•å…ƒ        â”‚  â”‚
            |    â”‚  â”‚  æ¯ä¸ªå•å…ƒå­˜å‚¨1bitæ•°æ®               â”‚  â”‚
            |    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
            |    â”‚                                          â”‚
            |    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |ğŸ¯ Userå¯¹è±¡åœ¨ç¡¬ä»¶ä¸­çš„å®é™…å­˜å‚¨ï¼š
            |  - å¯¹è±¡çš„æ¯ä¸ªå­—èŠ‚åˆ†å¸ƒåœ¨DRAMçš„å­˜å‚¨å•å…ƒä¸­
            |  - é€šè¿‡è¡Œåœ°å€(Row)å’Œåˆ—åœ°å€(Column)å®šä½
            |  - å¤šä¸ªBankå¯ä»¥å¹¶è¡Œè®¿é—®ï¼Œæé«˜æ€§èƒ½
        """.trimMargin())
        
        // è·å–è®¾å¤‡ç¡¬ä»¶ä¿¡æ¯
        getDeviceHardwareInfo()
    }
    
    private fun getDeviceHardwareInfo() {
        val activityManager = getSystemService(Context.ACTIVITY_SERVICE) as ActivityManager
        val memoryInfo = ActivityManager.MemoryInfo()
        activityManager.getMemoryInfo(memoryInfo)
        
        // è·å–CPUä¿¡æ¯
        val cpuInfo = getCPUInfo()
        
        Log.d("Hardware", """
            |ğŸ“Š å½“å‰è®¾å¤‡ç¡¬ä»¶è§„æ ¼ï¼š
            |  
            |  å†…å­˜ç¡¬ä»¶ï¼š
            |  â”œâ”€ æ€»å†…å­˜å®¹é‡: ${memoryInfo.totalMem / 1024 / 1024}MB
            |  â”œâ”€ å¯ç”¨å†…å­˜: ${memoryInfo.availMem / 1024 / 1024}MB
            |  â””â”€ å†…å­˜ç±»å‹: LPDDR4/LPDDR5 (ç§»åŠ¨è®¾å¤‡ä¸“ç”¨)
            |  
            |  CPUç¼“å­˜æ¶æ„ï¼š
            |  â”œâ”€ L1ç¼“å­˜: ~32KB (æŒ‡ä»¤) + 32KB (æ•°æ®)
            |  â”œâ”€ L2ç¼“å­˜: ~256KB - 1MB
            |  â””â”€ L3ç¼“å­˜: ~2MB - 8MB (éƒ¨åˆ†é«˜ç«¯èŠ¯ç‰‡)
            |  
            |  å¤„ç†å™¨ä¿¡æ¯ï¼š
            |  $cpuInfo
            |
            |ğŸ’» æŸ¥çœ‹è¯¦ç»†ç¡¬ä»¶ä¿¡æ¯ï¼š
            |  adb shell cat /proc/cpuinfo
            |  adb shell cat /proc/meminfo
        """.trimMargin())
    }
    
    private fun getCPUInfo(): String {
        return try {
            val runtime = Runtime.getRuntime()
            val process = runtime.exec("cat /proc/cpuinfo")
            val inputStream = process.inputStream
            val result = inputStream.bufferedReader().readLines().take(10).joinToString("\n")
            "å‰10è¡ŒCPUä¿¡æ¯å·²è¯»å–"
        } catch (e: Exception) {
            "æ— æ³•è¯»å–CPUä¿¡æ¯: ${e.message}"
        }
    }
    
    private fun analyzeCacheHierarchy() {
        Log.d("Hardware", """
            |ğŸ—ï¸ CPUç¼“å­˜å±‚æ¬¡ç»“æ„è¯¦è§£ï¼š
            |
            |  å½“CPUè¦è®¿é—®Userå¯¹è±¡æ—¶çš„å®Œæ•´è·¯å¾„ï¼š
            |
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚                    CPU Core                           â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
            |  â”‚  â”‚  L1 ç¼“å­˜ (æœ€å¿«: ~1nså»¶è¿Ÿ)                      â”‚   â”‚
            |  â”‚  â”‚  â”œâ”€ L1i: æŒ‡ä»¤ç¼“å­˜ (32KB)                     â”‚   â”‚
            |  â”‚  â”‚  â””â”€ L1d: æ•°æ®ç¼“å­˜ (32KB) â† Userå¯¹è±¡ä¼˜å…ˆç¼“å­˜  â”‚   â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
            |  â”‚                         â†“ æœªå‘½ä¸­                      â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
            |  â”‚  â”‚  L2 ç¼“å­˜ (è¾ƒå¿«: ~3nså»¶è¿Ÿ)                      â”‚   â”‚
            |  â”‚  â”‚  â”œâ”€ ç»Ÿä¸€ç¼“å­˜ (æŒ‡ä»¤+æ•°æ®)                      â”‚   â”‚
            |  â”‚  â”‚  â””â”€ å®¹é‡: 256KB - 1MB                       â”‚   â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |                         â†“ æœªå‘½ä¸­
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚  L3 ç¼“å­˜ (å¿«: ~12nså»¶è¿Ÿ) [éƒ¨åˆ†èŠ¯ç‰‡æœ‰]                    â”‚
            |  â”‚  â”œâ”€ å…±äº«ç¼“å­˜ (å¤šæ ¸å…±äº«)                                â”‚
            |  â”‚  â””â”€ å®¹é‡: 2MB - 8MB                                 â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |                         â†“ æœªå‘½ä¸­
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚  ä¸»å†…å­˜ DRAM (æ…¢: ~100nså»¶è¿Ÿ)                            â”‚
            |  â”‚  â”œâ”€ å®¹é‡: 6GB - 12GB                                  â”‚
            |  â”‚  â””â”€ è¿™é‡Œå­˜å‚¨ç€Userå¯¹è±¡çš„å®é™…æ•°æ®                        â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |ğŸ’¡ ç¼“å­˜å‘½ä¸­å¯¹æ€§èƒ½çš„å·¨å¤§å½±å“ï¼š
            |  - L1å‘½ä¸­: 1ns â†’ ç«‹å³è·å–Userå¯¹è±¡æ•°æ®
            |  - L2å‘½ä¸­: 3ns â†’ 3å€å»¶è¿Ÿ
            |  - L3å‘½ä¸­: 12ns â†’ 12å€å»¶è¿Ÿ  
            |  - å†…å­˜è®¿é—®: 100ns â†’ 100å€å»¶è¿Ÿï¼
        """.trimMargin())
        
        // æ¼”ç¤ºç¼“å­˜æ€§èƒ½å·®å¼‚
        demonstrateCachePerformance()
    }
    
    private fun demonstrateCachePerformance() {
        Log.d("Hardware", "ğŸš€ å®é™…æµ‹é‡ç¼“å­˜æ€§èƒ½å·®å¼‚")
        
        // æµ‹è¯•æ•°ç»„å¤§å°ï¼ˆè®¾è®¡ä¸ºä¸åŒçš„ç¼“å­˜å‘½ä¸­æ¨¡å¼ï¼‰
        val l1Size = 32 * 1024 / 4        // L1ç¼“å­˜å¤§å°ï¼Œ32KB / 4å­—èŠ‚ = 8Kæ•´æ•°
        val l2Size = 512 * 1024 / 4       // L2ç¼“å­˜å¤§å°ï¼Œ512KB / 4å­—èŠ‚ = 128Kæ•´æ•°
        val l3Size = 4 * 1024 * 1024 / 4  // L3ç¼“å­˜å¤§å°ï¼Œ4MB / 4å­—èŠ‚ = 1Mæ•´æ•°
        val ramSize = 64 * 1024 * 1024 / 4 // è¶…å‡ºæ‰€æœ‰ç¼“å­˜ï¼Œ64MB / 4å­—èŠ‚ = 16Mæ•´æ•°
        
        // æµ‹è¯•1: L1ç¼“å­˜å‹å¥½è®¿é—®
        val l1Array = IntArray(l1Size) { it }
        val l1Time = measureArrayAccess(l1Array, "L1ç¼“å­˜å‹å¥½")
        
        // æµ‹è¯•2: L2ç¼“å­˜å‹å¥½è®¿é—®
        val l2Array = IntArray(l2Size) { it }
        val l2Time = measureArrayAccess(l2Array, "L2ç¼“å­˜å‹å¥½")
        
        // æµ‹è¯•3: è¶…å‡ºç¼“å­˜è®¿é—®
        val ramArray = IntArray(ramSize) { it }
        val ramTime = measureArrayAccess(ramArray, "ä¸»å†…å­˜è®¿é—®")
        
        Log.d("Hardware", """
            |ğŸ“Š ç¼“å­˜æ€§èƒ½æµ‹è¯•ç»“æœï¼š
            |  L1ç¼“å­˜çº§åˆ«è®¿é—®: ${l1Time}ms
            |  L2ç¼“å­˜çº§åˆ«è®¿é—®: ${l2Time}ms  (${l2Time.toDouble() / l1Time}å€å»¶è¿Ÿ)
            |  ä¸»å†…å­˜è®¿é—®: ${ramTime}ms (${ramTime.toDouble() / l1Time}å€å»¶è¿Ÿ)
            |
            |ğŸ’¡ ç»“è®ºï¼šç¼“å­˜å‘½ä¸­ç‡ç›´æ¥å½±å“Userå¯¹è±¡çš„è®¿é—®æ€§èƒ½ï¼
        """.trimMargin())
    }
    
    private fun measureArrayAccess(array: IntArray, description: String): Long {
        val iterations = 10
        var totalTime = 0L
        
        repeat(iterations) {
            val startTime = System.nanoTime()
            
            // é¡ºåºè®¿é—®æ•°ç»„ï¼ˆç¼“å­˜å‹å¥½ï¼‰
            var sum = 0L
            for (i in array.indices) {
                sum += array[i]
            }
            
            val endTime = System.nanoTime()
            totalTime += (endTime - startTime)
            
            // é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
            if (sum < 0) Log.d("Hardware", "ä¸å¯èƒ½çš„ç»“æœ")
        }
        
        val avgTimeMs = totalTime / iterations / 1_000_000
        Log.d("Hardware", "$description å¹³å‡è®¿é—®æ—¶é—´: ${avgTimeMs}ms")
        
        return avgTimeMs
    }
    
    private fun measureMemoryPerformance() {
        Log.d("Hardware", "â±ï¸ ç»¼åˆå†…å­˜æ€§èƒ½æµ‹è¯•")
        
        // æµ‹è¯•ä¸åŒçš„å†…å­˜è®¿é—®æ¨¡å¼å¯¹Userå¯¹è±¡æ“ä½œçš„å½±å“
        
        // æµ‹è¯•1: é¡ºåºåˆ›å»ºUserå¯¹è±¡ï¼ˆç¼“å­˜å‹å¥½ï¼‰
        val sequentialTime = measureUserObjectCreation("sequential") { count ->
            Array(count) { User("Sequential_$it") }
        }
        
        // æµ‹è¯•2: éšæœºè®¿é—®Userå¯¹è±¡ï¼ˆç¼“å­˜ä¸å‹å¥½ï¼‰
        val users = Array(10000) { User("Random_$it") }
        val randomTime = measureUserObjectAccess("random", users) { userArray ->
            val random = kotlin.random.Random(42)
            var nameLength = 0
            repeat(userArray.size) {
                val randomIndex = random.nextInt(userArray.size)
                nameLength += userArray[randomIndex].name.length
            }
            nameLength
        }
        
        // æµ‹è¯•3: é¡ºåºè®¿é—®Userå¯¹è±¡ï¼ˆç¼“å­˜å‹å¥½ï¼‰
        val sequentialAccessTime = measureUserObjectAccess("sequential", users) { userArray ->
            var nameLength = 0
            for (user in userArray) {
                nameLength += user.name.length
            }
            nameLength
        }
        
        Log.d("Hardware", """
            |ğŸ“Š Userå¯¹è±¡å†…å­˜æ€§èƒ½ç»¼åˆæµ‹è¯•ï¼š
            |  é¡ºåºåˆ›å»ºUserå¯¹è±¡: ${sequentialTime}ms
            |  éšæœºè®¿é—®Userå¯¹è±¡: ${randomTime}ms  
            |  é¡ºåºè®¿é—®Userå¯¹è±¡: ${sequentialAccessTime}ms
            |  
            |ğŸ’¡ æ€§èƒ½å·®å¼‚åˆ†æï¼š
            |  éšæœºvsé¡ºåºè®¿é—®æ€§èƒ½æ¯”: ${randomTime.toDouble() / sequentialAccessTime}
            |  
            |ğŸ¯ Androidå¼€å‘å¯ç¤ºï¼š
            |  - å°½é‡é¡ºåºè®¿é—®å¯¹è±¡æ•°ç»„
            |  - é¿å…éšæœºè·³è·ƒå¼çš„å†…å­˜è®¿é—®
            |  - è€ƒè™‘æ•°æ®ç»“æ„çš„ç¼“å­˜å±€éƒ¨æ€§
        """.trimMargin())
    }
    
    private fun measureUserObjectCreation(type: String, creation: (Int) -> Array<User>): Long {
        val startTime = System.nanoTime()
        val users = creation(5000)
        val endTime = System.nanoTime()
        
        // é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
        Log.d("Hardware", "$type åˆ›å»º${users.size}ä¸ªUserå¯¹è±¡")
        
        return (endTime - startTime) / 1_000_000
    }
    
    private fun measureUserObjectAccess(type: String, users: Array<User>, access: (Array<User>) -> Int): Long {
        val startTime = System.nanoTime()
        val result = access(users)
        val endTime = System.nanoTime()
        
        // é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–
        Log.d("Hardware", "$type è®¿é—®ç»“æœ: $result")
        
        return (endTime - startTime) / 1_000_000
    }
}

data class User(val name: String) {
    val id: Long = System.currentTimeMillis() + kotlin.random.Random.nextLong(1000)
    val data: ByteArray = ByteArray(256) { it.toByte() }
}
```

## 3.2 åŸºäºç¡¬ä»¶ç‰¹æ€§çš„Androidä¼˜åŒ– (8åˆ†é’Ÿ)

### ğŸš€ ç¡¬ä»¶çŸ¥è¯†çš„å®é™…åº”ç”¨

```kotlin
class HardwareBasedOptimization {
    
    fun demonstrateHardwareOptimizations() {
        Log.d("Optimization", "ğŸš€ åŸºäºç¡¬ä»¶ç‰¹æ€§çš„Androidä¼˜åŒ–å®è·µ")
        
        // ä¼˜åŒ–1: ç¼“å­˜å±€éƒ¨æ€§ä¼˜åŒ–
        optimizeCacheLocality()
        
        // ä¼˜åŒ–2: å†…å­˜å¸¦å®½ä¼˜åŒ–
        optimizeMemoryBandwidth()
        
        // ä¼˜åŒ–3: åŸºäºç¡¬ä»¶çš„æ•°æ®ç»“æ„è®¾è®¡
        designHardwareFriendlyDataStructures()
    }
    
    private fun optimizeCacheLocality() {
        Log.d("Optimization", "ğŸ¯ ä¼˜åŒ–1ï¼šåˆ©ç”¨ç¼“å­˜å±€éƒ¨æ€§æå‡Userå¯¹è±¡å¤„ç†æ€§èƒ½")
        
        val userCount = 50000
        
        // âŒ ç¼“å­˜ä¸å‹å¥½çš„Userå¤„ç†æ–¹å¼
        class CacheUnfriendlyUserProcessor {
            val users = mutableListOf<User>()
            val userIds = mutableListOf<Long>()
            val userNames = mutableListOf<String>()
            val userData = mutableListOf<ByteArray>()
            
            fun processUsers() {
                // æ•°æ®åˆ†æ•£å­˜å‚¨ï¼Œå¯¼è‡´ç¼“å­˜miss
                for (i in users.indices) {
                    val user = users[i]         // è®¿é—®Userå¯¹è±¡
                    val id = userIds[i]         // è·³è½¬åˆ°å¦ä¸€ä¸ªå†…å­˜åŒºåŸŸ
                    val name = userNames[i]     // å†æ¬¡è·³è½¬
                    val data = userData[i]      // åˆä¸€æ¬¡è·³è½¬
                    
                    // æ¨¡æ‹Ÿå¤„ç†é€»è¾‘
                    val processed = processUserData(user, id, name, data)
                }
            }
            
            private fun processUserData(user: User, id: Long, name: String, data: ByteArray): Boolean {
                return user.name.length + id.toString().length + name.length + data.size > 0
            }
        }
        
        // âœ… ç¼“å­˜å‹å¥½çš„Userå¤„ç†æ–¹å¼
        class CacheFriendlyUserProcessor {
            data class CompactUserData(
                val user: User,
                val id: Long, 
                val name: String,
                val data: ByteArray
            )
            
            val compactUsers = mutableListOf<CompactUserData>()
            
            fun processUsers() {
                // æ•°æ®ç´§å¯†å­˜å‚¨ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡
                for (compactUser in compactUsers) {
                    // æ‰€æœ‰æ•°æ®åœ¨åŒä¸€ä¸ªç¼“å­˜è¡Œä¸­
                    val processed = processCompactUserData(compactUser)
                }
            }
            
            private fun processCompactUserData(compactUser: CompactUserData): Boolean {
                return compactUser.user.name.length + 
                       compactUser.id.toString().length + 
                       compactUser.name.length + 
                       compactUser.data.size > 0
            }
        }
        
        // æ€§èƒ½å¯¹æ¯”æµ‹è¯•
        val unfriendlyProcessor = CacheUnfriendlyUserProcessor()
        val friendlyProcessor = CacheFriendlyUserProcessor()
        
        // å¡«å……æµ‹è¯•æ•°æ®
        repeat(userCount) { i ->
            val user = User("User$i")
            
            unfriendlyProcessor.users.add(user)
            unfriendlyProcessor.userIds.add(user.id)
            unfriendlyProcessor.userNames.add(user.name)
            unfriendlyProcessor.userData.add(user.data)
            
            friendlyProcessor.compactUsers.add(
                CacheFriendlyUserProcessor.CompactUserData(user, user.id, user.name, user.data)
            )
        }
        
        // æ€§èƒ½æµ‹è¯•
        val unfriendlyTime = measurePerformance("ç¼“å­˜ä¸å‹å¥½") {
            unfriendlyProcessor.processUsers()
        }
        
        val friendlyTime = measurePerformance("ç¼“å­˜å‹å¥½") {
            friendlyProcessor.processUsers()
        }
        
        Log.d("Optimization", """
            |ğŸ“Š ç¼“å­˜å±€éƒ¨æ€§ä¼˜åŒ–ç»“æœï¼š
            |  ç¼“å­˜ä¸å‹å¥½å¤„ç†: ${unfriendlyTime}ms
            |  ç¼“å­˜å‹å¥½å¤„ç†: ${friendlyTime}ms
            |  æ€§èƒ½æå‡: ${unfriendlyTime.toDouble() / friendlyTime}å€
            |  
            |ğŸ’¡ ä¼˜åŒ–åŸç†ï¼š
            |  - ç›¸å…³æ•°æ®å­˜å‚¨åœ¨é‚»è¿‘å†…å­˜ä½ç½®
            |  - å‡å°‘ç¼“å­˜missï¼Œæé«˜å‘½ä¸­ç‡
            |  - å……åˆ†åˆ©ç”¨ç¼“å­˜è¡Œçš„ç©ºé—´å±€éƒ¨æ€§
        """.trimMargin())
    }
    
    private fun optimizeMemoryBandwidth() {
        Log.d("Optimization", "ğŸ›£ï¸ ä¼˜åŒ–2ï¼šå‡å°‘å†…å­˜å¸¦å®½æ¶ˆè€—")
        
        val itemCount = 100000
        
        // âŒ é«˜å†…å­˜å¸¦å®½æ¶ˆè€—çš„åšæ³•
        class HighBandwidthProcessor {
            data class DetailedUser(
                val name: String,
                val email: String,
                val address: String,
                val phoneNumber: String,
                val biography: String,  // å¤§é‡ä¸å¸¸ç”¨æ•°æ®
                val preferences: String,
                val history: ByteArray,
                val metadata: ByteArray
            )
            
            fun processUsers(): Long {
                val users = Array(itemCount) { i ->
                    DetailedUser(
                        "User$i",
                        "user$i@example.com",
                        "Address $i",
                        "Phone$i",
                        "Very long biography for user $i".repeat(10),
                        "Preferences for user $i".repeat(5),
                        ByteArray(1024) { it.toByte() },
                        ByteArray(2048) { it.toByte() }
                    )
                }
                
                var result = 0L
                // å³ä½¿åªéœ€è¦nameï¼Œä¹Ÿè¦åŠ è½½æ•´ä¸ªå¯¹è±¡
                for (user in users) {
                    result += user.name.length  // åªç”¨nameï¼Œä½†åŠ è½½äº†æ‰€æœ‰æ•°æ®
                }
                return result
            }
        }
        
        // âœ… ä½å†…å­˜å¸¦å®½æ¶ˆè€—çš„åšæ³•
        class LowBandwidthProcessor {
            // åˆ†ç¦»çƒ­æ•°æ®å’Œå†·æ•°æ®
            data class HotUserData(val name: String, val id: Long)  // å¸¸ç”¨æ•°æ®
            data class ColdUserData(  // ä¸å¸¸ç”¨æ•°æ®
                val email: String,
                val address: String, 
                val phoneNumber: String,
                val biography: String,
                val preferences: String,
                val history: ByteArray,
                val metadata: ByteArray
            )
            
            fun processUsers(): Long {
                // åªåŠ è½½éœ€è¦çš„çƒ­æ•°æ®
                val hotData = Array(itemCount) { i ->
                    HotUserData("User$i", i.toLong())
                }
                
                var result = 0L
                // åªè®¿é—®éœ€è¦çš„æ•°æ®ï¼ŒèŠ‚çº¦å†…å­˜å¸¦å®½
                for (data in hotData) {
                    result += data.name.length
                }
                return result
            }
        }
        
        val highBandwidthProcessor = HighBandwidthProcessor()
        val lowBandwidthProcessor = LowBandwidthProcessor()
        
        val highBandwidthTime = measurePerformance("é«˜å¸¦å®½æ¶ˆè€—") {
            highBandwidthProcessor.processUsers()
        }
        
        val lowBandwidthTime = measurePerformance("ä½å¸¦å®½æ¶ˆè€—") {
            lowBandwidthProcessor.processUsers()
        }
        
        Log.d("Optimization", """
            |ğŸ“Š å†…å­˜å¸¦å®½ä¼˜åŒ–ç»“æœï¼š
            |  é«˜å¸¦å®½æ¶ˆè€—å¤„ç†: ${highBandwidthTime}ms
            |  ä½å¸¦å®½æ¶ˆè€—å¤„ç†: ${lowBandwidthTime}ms  
            |  æ€§èƒ½æå‡: ${highBandwidthTime.toDouble() / lowBandwidthTime}å€
            |  
            |ğŸ’¡ ä¼˜åŒ–åŸç†ï¼š
            |  - çƒ­æ•°æ®ä¸å†·æ•°æ®åˆ†ç¦»
            |  - åªåŠ è½½å¿…è¦çš„æ•°æ®åˆ°å†…å­˜
            |  - å‡å°‘å†…å­˜æ€»çº¿çš„æ•°æ®ä¼ è¾“é‡
        """.trimMargin())
    }
    
    private fun designHardwareFriendlyDataStructures() {
        Log.d("Optimization", "ğŸ—ï¸ ä¼˜åŒ–3ï¼šç¡¬ä»¶å‹å¥½çš„æ•°æ®ç»“æ„è®¾è®¡")
        
        // âŒ ä¼ ç»Ÿçš„é¢å‘å¯¹è±¡è®¾è®¡ï¼ˆä¸è€ƒè™‘ç¡¬ä»¶ç‰¹æ€§ï¼‰
        class TraditionalUserManager {
            class User(val name: String, val age: Int, val email: String) {
                fun getDisplayName(): String = name
                fun getAge(): Int = age
                fun getEmail(): String = email
            }
            
            private val users = mutableListOf<User>()
            
            fun processAllUsers(): String {
                var result = ""
                for (user in users) {
                    result += user.getDisplayName() + " "  // è®¿é—®æ¯ä¸ªUserå¯¹è±¡
                }
                return result
            }
            
            fun addUser(name: String, age: Int, email: String) {
                users.add(User(name, age, email))
            }
        }
        
        // âœ… ç¡¬ä»¶å‹å¥½çš„SOA (Structure of Arrays) è®¾è®¡
        class HardwareFriendlyUserManager {
            // å°†å¯¹è±¡çš„å±æ€§åˆ†åˆ«å­˜å‚¨åœ¨ä¸åŒæ•°ç»„ä¸­
            private val names = mutableListOf<String>()
            private val ages = mutableListOf<Int>()
            private val emails = mutableListOf<String>()
            
            fun processAllUsers(): String {
                var result = ""
                // é¡ºåºè®¿é—®åå­—æ•°ç»„ï¼Œç¼“å­˜å±€éƒ¨æ€§å¥½
                for (name in names) {
                    result += "$name "
                }
                return result
            }
            
            fun addUser(name: String, age: Int, email: String) {
                names.add(name)
                ages.add(age)
                emails.add(email)
            }
            
            fun getUserCount(): Int = names.size
        }
        
        val userCount = 20000
        
        // æµ‹è¯•ä¼ ç»Ÿæ–¹å¼
        val traditionalManager = TraditionalUserManager()
        repeat(userCount) { i ->
            traditionalManager.addUser("User$i", 20 + i % 50, "user$i@example.com")
        }
        
        // æµ‹è¯•ç¡¬ä»¶å‹å¥½æ–¹å¼
        val hardwareFriendlyManager = HardwareFriendlyUserManager()
        repeat(userCount) { i ->
            hardwareFriendlyManager.addUser("User$i", 20 + i % 50, "user$i@example.com")
        }
        
        val traditionalTime = measurePerformance("é¢å‘å¯¹è±¡è®¾è®¡") {
            traditionalManager.processAllUsers()
        }
        
        val hardwareFriendlyTime = measurePerformance("ç¡¬ä»¶å‹å¥½è®¾è®¡") {
            hardwareFriendlyManager.processAllUsers()
        }
        
        Log.d("Optimization", """
            |ğŸ“Š ç¡¬ä»¶å‹å¥½æ•°æ®ç»“æ„ä¼˜åŒ–ç»“æœï¼š
            |  ä¼ ç»ŸOOPè®¾è®¡: ${traditionalTime}ms
            |  SOAè®¾è®¡: ${hardwareFriendlyTime}ms
            |  æ€§èƒ½æå‡: ${traditionalTime.toDouble() / hardwareFriendlyTime}å€
            |  
            |ğŸ’¡ è®¾è®¡åŸç†ï¼š
            |  - Structure of Arrays vs Array of Structures  
            |  - ç›¸åŒç±»å‹æ•°æ®è¿ç»­å­˜å‚¨
            |  - æé«˜ç¼“å­˜è¡Œåˆ©ç”¨ç‡
            |  - æ”¯æŒSIMDæŒ‡ä»¤ä¼˜åŒ–
            |
            |ğŸ¯ é€‚ç”¨åœºæ™¯ï¼š
            |  - å¤§é‡åŒç±»æ•°æ®çš„æ‰¹å¤„ç†
            |  - æ¸¸æˆå¼•æ“çš„å®ä½“ç»„ä»¶ç³»ç»Ÿ
            |  - å›¾åƒå¤„ç†å’Œç§‘å­¦è®¡ç®—
        """.trimMargin())
    }
    
    private fun measurePerformance(description: String, operation: () -> Any): Long {
        val startTime = System.nanoTime()
        val result = operation()
        val endTime = System.nanoTime()
        
        val timeMs = (endTime - startTime) / 1_000_000
        
        // é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æ‰æ“ä½œ
        if (result.toString().isEmpty()) {
            Log.d("Optimization", "ä¸å¯èƒ½çš„ç»“æœ")
        }
        
        return timeMs
    }
}
```

---

# ğŸ¯ æ€»ç»“ï¼šè¿›ç¨‹ç©ºé—´çš„å®Œæ•´è®¤çŸ¥ (15åˆ†é’Ÿ)

## ğŸ”¬ ä¸‰å±‚æ˜¾å¾®é•œçš„å®Œæ•´ç­”æ¡ˆ

### å›åˆ°æœ€åˆçš„é—®é¢˜ï¼šUserå¯¹è±¡çš„å®Œæ•´å­˜å‚¨è·¯å¾„

```kotlin
class CompleteAnswer {
    
    fun provideCompleteAnswer() {
        Log.d("CompleteAnswer", """
            |ğŸ¯ å®Œæ•´å›ç­”ï¼šUserå¯¹è±¡åœ¨Androidç³»ç»Ÿä¸­çš„å®Œæ•´å­˜å‚¨è·¯å¾„
            |
            |è®©æˆ‘ä»¬ç”¨ä¸‰å±‚æ˜¾å¾®é•œçš„è§†è§’ï¼Œå®Œæ•´å›ç­”å¼€åœºçš„é—®é¢˜ï¼š
            |
            |```kotlin
            |val user = User("Android Developer")
            |```
            |
            |ğŸ”¬ 40xæ˜¾å¾®é•œ - Javaå †å¿«é€Ÿå®šä½ï¼š
            |  Userå¯¹è±¡å­˜å‚¨ä½ç½®ï¼šARTè™šæ‹Ÿæœºçš„Javaå †
            |  â”œâ”€ å…·ä½“åŒºåŸŸï¼šEdenåŒºï¼ˆæ–°åˆ›å»ºå¯¹è±¡çš„åˆå§‹ä½ç½®ï¼‰
            |  â”œâ”€ ç®¡ç†æ–¹å¼ï¼šåˆ†ä»£åƒåœ¾å›æ”¶æœºåˆ¶
            |  â”œâ”€ ç”Ÿå‘½å‘¨æœŸï¼šåˆ›å»ºâ†’ä½¿ç”¨â†’GCå›æ”¶
            |  â””â”€ ç‰¹ç‚¹ï¼šè‡ªåŠ¨å†…å­˜ç®¡ç†ï¼Œå¼€å‘è€…å‹å¥½
            |
            |ğŸ”¬ 400xæ˜¾å¾®é•œ - è¿›ç¨‹ç©ºé—´æ·±åº¦å‰–æã€é‡ç‚¹ã€‘ï¼š
            |  Javaå †åœ¨è¿›ç¨‹è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„ä½ç½®å’Œå…³ç³»
            |  
            |  ä¸‰å±‚åµŒå¥—ç»“æ„ï¼š
            |  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            |  â”‚ 1. è¿›ç¨‹å †æ®µ (Linuxå†…æ ¸åˆ†é…çš„è™šæ‹Ÿå†…å­˜åŸºç¡€)             â”‚
            |  â”‚    â””â”€ åœ°å€èŒƒå›´: 0x08048000 - 0x????????           â”‚
            |  â”‚    â””â”€ ç®¡ç†è€…: Linuxå†…æ ¸å†…å­˜ç®¡ç†å™¨                  â”‚
            |  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
            |  â”‚  â”‚ 2. Nativeå † (C/C++å†…å­˜åˆ†é…å™¨ç®¡ç†)              â”‚ â”‚
            |  â”‚  â”‚    â””â”€ åˆ†é…å™¨: jemalloc/dlmalloc               â”‚ â”‚
            |  â”‚  â”‚    â””â”€ æ¥å£: malloc/free                      â”‚ â”‚
            |  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
            |  â”‚  â”‚  â”‚ 3. ART Javaå † (ARTè™šæ‹Ÿæœºä¸“ç”¨ç®¡ç†)         â”‚ â”‚ â”‚
            |  â”‚  â”‚  â”‚    â”œâ”€ EdenåŒº â† Userå¯¹è±¡åœ¨è¿™é‡Œï¼            â”‚ â”‚ â”‚
            |  â”‚  â”‚  â”‚    â”œâ”€ SurvivoråŒº                         â”‚ â”‚ â”‚
            |  â”‚  â”‚  â”‚    â””â”€ OldåŒº                              â”‚ â”‚ â”‚
            |  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
            |  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
            |  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            |
            |  Androidç‰¹æœ‰æœºåˆ¶ï¼š
            |  â”œâ”€ Zygoteè¿›ç¨‹å·¥å‚ï¼šå¿«é€Ÿåˆ›å»ºåº”ç”¨è¿›ç¨‹
            |  â”œâ”€ Copy-On-Writeï¼šé«˜æ•ˆçš„å†…å­˜å…±äº«æœºåˆ¶
            |  â”œâ”€ Low Memory Killerï¼šæ™ºèƒ½çš„å†…å­˜å›æ”¶
            |  â””â”€ Android 8å˜é©ï¼šå›¾ç‰‡å†…å­˜ä»Javaå †è¿ç§»åˆ°Nativeå †
            |
            |ğŸ”¬ 4000xæ˜¾å¾®é•œ - ç¡¬ä»¶åŸºç¡€ï¼š
            |  è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†ç¡¬ä»¶çš„æœ€ç»ˆæ˜ å°„
            |  â”œâ”€ è™šæ‹Ÿåœ°å€ï¼š0x12345678 (ç¤ºä¾‹)
            |  â”œâ”€ ç‰©ç†åœ°å€ï¼š0x87654321 (ç¤ºä¾‹ï¼Œé€šè¿‡MMUè½¬æ¢)
            |  â”œâ”€ ç¡¬ä»¶ä½ç½®ï¼šDRAMèŠ¯ç‰‡çš„å­˜å‚¨å•å…ƒ
            |  â””â”€ è®¿é—®è·¯å¾„ï¼šCPUç¼“å­˜å±‚æ¬¡ â†’ ä¸»å†…å­˜
        """.trimMargin())
        
        summarizeKeyFindings()
    }
    
    private fun summarizeKeyFindings() {
        Log.d("CompleteAnswer", """
            |ğŸŒŸ ä»Šå¤©æ¼”è®²çš„æ ¸å¿ƒå‘ç°ï¼š
            |
            |ğŸ’ æœ€é‡è¦å‘ç°ï¼šä¸‰å±‚å †çš„åµŒå¥—å…³ç³»
            |  è¿™æ˜¯ç†è§£Androidå†…å­˜ç®¡ç†çš„å…³é”®ï¼
            |  è¿›ç¨‹å †æ®µ âŠƒ Nativeå † âŠƒ ART Javaå † âŠƒ Userå¯¹è±¡
            |
            |ğŸš€ Androidæ¶æ„ä¼˜åŠ¿ï¼š
            |  1. Zygoteæœºåˆ¶ï¼šåº”ç”¨å¯åŠ¨é€Ÿåº¦æå‡10å€
            |  2. COWä¼˜åŒ–ï¼šå¤šè¿›ç¨‹å†…å­˜å…±äº«ï¼ŒèŠ‚çœå†…å­˜
            |  3. LMKæœºåˆ¶ï¼šæ™ºèƒ½å†…å­˜ç®¡ç†ï¼Œç³»ç»Ÿæ›´ç¨³å®š
            |  4. åˆ†å±‚æ¶æ„ï¼šä¸åŒå±‚é¢çš„ä¼˜åŒ–ç­–ç•¥
            |
            |ğŸ“Š å®é™…å¼€å‘ä»·å€¼ï¼š
            |  1. å†…å­˜é—®é¢˜ç²¾å‡†å®šä½ï¼šçŸ¥é“é—®é¢˜å‘ç”Ÿåœ¨å“ªä¸€å±‚
            |  2. æ€§èƒ½ä¼˜åŒ–æœ‰çš„æ”¾çŸ¢ï¼šåŸºäºä¸åŒå±‚æ¬¡ç‰¹æ€§ä¼˜åŒ–
            |  3. å·¥å…·ä½¿ç”¨æ›´ä¸“ä¸šï¼šMemory Profilerçš„æ·±åº¦ä½¿ç”¨
            |  4. æ¶æ„è®¾è®¡æ›´åˆç†ï¼šè€ƒè™‘ç¡¬ä»¶ç‰¹æ€§çš„æ•°æ®ç»“æ„
            |
            |ğŸ¯ çŸ¥è¯†ä½“ç³»å®Œå–„ï¼š
            |  - ä»Javaä»£ç åˆ°ç‰©ç†ç¡¬ä»¶çš„å®Œæ•´é“¾æ¡
            |  - ä»ç°è±¡åˆ°æœ¬è´¨çš„æ·±åº¦ç†è§£
            |  - ä»é—®é¢˜è¯Šæ–­åˆ°æ€§èƒ½ä¼˜åŒ–çš„å®ç”¨æŠ€èƒ½
        """.trimMargin())
    }
}
```

## ğŸ“ å­¦ä¹ æˆæœæ£€éªŒ

### ç°åœ¨ä½ ä»¬åº”è¯¥èƒ½å¤Ÿå›ç­”ï¼š

```kotlin
class KnowledgeVerification {
    
    fun verifyUnderstanding() {
        Log.d("Verification", """
            |ğŸ“ çŸ¥è¯†æŒæ¡æ£€éªŒï¼š
            |
            |åŸºç¡€é—®é¢˜ï¼š
            |â–¡ Userå¯¹è±¡å­˜åœ¨å“ªé‡Œï¼Ÿï¼ˆä¸‰å±‚ç­”æ¡ˆï¼‰
            |â–¡ ä¸ºä»€ä¹ˆAndroidåº”ç”¨å¯åŠ¨è¿™ä¹ˆå¿«ï¼Ÿ
            |â–¡ ä»€ä¹ˆæ˜¯Copy-On-Writeï¼Ÿ
            |â–¡ Android 8ä¸ºä»€ä¹ˆè¦æ”¹å˜å›¾ç‰‡å†…å­˜åˆ†é…ï¼Ÿ
            |
            |è¿›é˜¶é—®é¢˜ï¼š
            |â–¡ å¦‚ä½•ç”¨Memory Profileråˆ†æä¸‰å±‚å †ï¼Ÿ
            |â–¡ ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè§¦å‘Low Memory Killerï¼Ÿ
            |â–¡ ä¸»çº¿ç¨‹æ ˆå’Œæ™®é€šçº¿ç¨‹æ ˆæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
            |â–¡ å¦‚ä½•è®¾è®¡ç¼“å­˜å‹å¥½çš„æ•°æ®ç»“æ„ï¼Ÿ
            |
            |åº”ç”¨é—®é¢˜ï¼š
            |â–¡ å¦‚ä½•å®šä½å†…å­˜æ³„æ¼å‘ç”Ÿåœ¨å“ªä¸€å±‚ï¼Ÿ
            |â–¡ å¦‚ä½•åŸºäºç¡¬ä»¶ç‰¹æ€§ä¼˜åŒ–Androidåº”ç”¨ï¼Ÿ
            |â–¡ ä»€ä¹ˆæ—¶å€™åº”è¯¥è€ƒè™‘å¯¹è±¡æ± æ¨¡å¼ï¼Ÿ
            |â–¡ å¦‚ä½•å¹³è¡¡å†…å­˜ä½¿ç”¨å’Œæ€§èƒ½ï¼Ÿ
        """.trimMargin())
    }
}
```

## ğŸ“š åç»­å­¦ä¹ è·¯å¾„

### ğŸš€ ç«‹å³è¡ŒåŠ¨å»ºè®®

1. **ä»Šå¤©å›å»å°±åš**ï¼š
   - ç”¨Memory Profileråˆ†æè‡ªå·±çš„é¡¹ç›®
   - è§‚å¯ŸJavaå †å’ŒNativeå †çš„æ¯”ä¾‹
   - å¯»æ‰¾æ½œåœ¨çš„å†…å­˜ä¼˜åŒ–ç‚¹

2. **æœ¬å‘¨å†…å®Œæˆ**ï¼š
   - é›†æˆLeakCanaryåˆ°debugç‰ˆæœ¬
   - å­¦ä¼šä½¿ç”¨dumpsys meminfoå‘½ä»¤
   - å°è¯•ä¸€ä¸ªå¯¹è±¡æ± ä¼˜åŒ–

3. **æœ¬æœˆå†…æŒæ¡**ï¼š
   - æ·±å…¥å­¦ä¹ æœ€æ„Ÿå…´è¶£çš„ä¸€å±‚ï¼ˆJavaå †/è¿›ç¨‹ç©ºé—´/ç¡¬ä»¶ï¼‰
   - åœ¨å›¢é˜Ÿå†…åˆ†äº«ä»Šå¤©çš„çŸ¥è¯†
   - åŸºäºä¸‰å±‚è§†è§’è§£å†³ä¸€ä¸ªå®é™…å†…å­˜é—®é¢˜

### ğŸ“– æ·±å…¥å­¦ä¹ èµ„æº

```kotlin
val learningResources = mapOf(
    "å®˜æ–¹æ–‡æ¡£" to listOf(
        "Androidå®˜æ–¹å†…å­˜ç®¡ç†æŒ‡å—",
        "ARTå’ŒDalvikè™šæ‹Ÿæœºæ–‡æ¡£",
        "Memory Profilerä½¿ç”¨æ‰‹å†Œ"
    ),
    "å¼€æºé¡¹ç›®" to listOf(
        "Androidç³»ç»Ÿæºç  (AOSP)",
        "LeakCanaryæºç åˆ†æ",
        "jemallocå†…å­˜åˆ†é…å™¨"
    ),
    "æŠ€æœ¯ä¹¦ç±" to listOf(
        "ã€Šæ·±å…¥ç†è§£Androidã€‹",
        "ã€ŠAndroidç³»ç»Ÿæºä»£ç æƒ…æ™¯åˆ†æã€‹",
        "ã€Šè®¡ç®—æœºç³»ç»Ÿè¦ç´ ã€‹"
    ),
    "å®è·µå·¥å…·" to listOf(
        "Memory Profilerè¿›é˜¶ä½¿ç”¨",
        "MAT (Memory Analyzer Tool)",
        "å‘½ä»¤è¡Œå†…å­˜åˆ†æå·¥å…·é›†"
    )
)
```

---

## ğŸ™ æ¼”è®²ç»“æŸ

### æ„Ÿè°¢å¤§å®¶å‚ä¸è¿™æ¬¡è¿›ç¨‹ç©ºé—´æ·±åº¦æ¢ç´¢ï¼

**ä»Šå¤©çš„é‡ç‚¹å›é¡¾**ï¼š
- âœ… **15åˆ†é’Ÿ** Javaå †å¿«é€Ÿå®šä½
- âœ… **50åˆ†é’Ÿ** è¿›ç¨‹ç©ºé—´æ·±åº¦å‰–æï¼ˆæ¼”è®²æ ¸å¿ƒï¼‰
- âœ… **20åˆ†é’Ÿ** ç¡¬ä»¶åŸºç¡€ä¸ä¼˜åŒ–
- âœ… **å®Œæ•´ç†è§£** ä¸‰å±‚å †åµŒå¥—å…³ç³»

**æ ¸å¿ƒä»·å€¼**ï¼š
è®©æ¯ä¸ªJavaå¼€å‘è€…éƒ½èƒ½ç†è§£Userå¯¹è±¡èƒŒåçš„å®Œæ•´å­˜å‚¨æ¶æ„ï¼ŒæŒæ¡åŸºäºè¿›ç¨‹ç©ºé—´çš„å†…å­˜ä¼˜åŒ–èƒ½åŠ›ã€‚

**è”ç³»æ–¹å¼**ï¼š[ä½ çš„è”ç³»æ–¹å¼]  
**æ¼”è®²èµ„æ–™**ï¼š[èµ„æ–™ä¸‹è½½é“¾æ¥]  
**Demoä»£ç **ï¼š[GitHubä»“åº“é“¾æ¥]

æœ‰ä»»ä½•å…³äºè¿›ç¨‹å†…å­˜ç©ºé—´çš„é—®é¢˜ï¼Œæ¬¢è¿éšæ—¶äº¤æµï¼

---

## ğŸ“ å¿«é€Ÿå‚è€ƒå¡

### ğŸ”¬ ä¸‰å±‚æ˜¾å¾®é•œæ£€æŸ¥æ¸…å•

#### 40x - Javaå †é—®é¢˜æ’æŸ¥
```
â–¡ å¯¹è±¡æ˜¯å¦æ­£ç¡®åˆ†é…åˆ°EdenåŒº
â–¡ GCæ˜¯å¦è¿‡äºé¢‘ç¹
â–¡ æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼
```

#### 400x - è¿›ç¨‹ç©ºé—´é—®é¢˜æ’æŸ¥ã€é‡ç‚¹ã€‘
```
â–¡ Javaå †å è¿›ç¨‹å†…å­˜æ¯”ä¾‹æ˜¯å¦æ­£å¸¸
â–¡ Nativeå †æ˜¯å¦å¼‚å¸¸å¢é•¿ 
â–¡ ä¸‰å±‚å †åµŒå¥—å…³ç³»æ˜¯å¦ç†è§£æ¸…æ¥š
â–¡ Zygote COWæœºåˆ¶æ˜¯å¦å‘æŒ¥ä½œç”¨
â–¡ Androidç‰¹æ€§æ˜¯å¦è¢«åˆç†åˆ©ç”¨
```

#### 4000x - ç¡¬ä»¶å±‚é¢ä¼˜åŒ–
```
â–¡ æ•°æ®ç»“æ„æ˜¯å¦ç¼“å­˜å‹å¥½
â–¡ å†…å­˜è®¿é—®æ¨¡å¼æ˜¯å¦ä¼˜åŒ–
â–¡ æ˜¯å¦è€ƒè™‘äº†ç¡¬ä»¶ç‰¹æ€§
```

**æ¼”è®²å®Œæ¯•ï¼** ğŸ‰